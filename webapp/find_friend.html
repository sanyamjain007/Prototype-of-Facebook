<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

   <!--  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

     Latest compiled JavaScript 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    Latest compiled and minified CSS 
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->
    <link rel="stylesheet" type="text/css" href="dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css"
	href="dist/css/bootstrap-theme.min.css">
	<script src="dist/js/jquery-3.1.1.js"></script>
	<script src="dist/js/bootstrap.js"></script>
	<script src="dist/font/"></script>
    <link rel="stylesheet" type="text/css" href="fbhome.css">
    
    <meta http-equiv='cache-control' content='no-cache'>
	<meta http-equiv='expires' content='0'>
	<meta http-equiv='pragma' content='no-cache'>
	<style>
     @media only screen and (max-width : 540px) 
            {
                
                
            }
    .popup-box
            {
                z-index:10000000;
                position: fixed;
                bottom: 0px;
                right: 220px;
                height: 285px;
                background-color: rgb(237, 239, 244);
                width: 300px;
                border: 1px solid rgba(29, 49, 91, .3);
            }
            
            .popup-box .popup-head
            {
                background-color: #6d84b4;
                padding: 5px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                clear: both;
            }
            
            .popup-box .popup-head .popup-head-left
            {
                float: left;
            }
            
            .popup-box .popup-head .popup-head-right
            {
                float: right;
                opacity: 0.5;
            }
            
            .popup-box .popup-head .popup-head-right a
            {
                text-decoration: none;
                color: inherit;
            }
            
            .popup-box .popup-messages
            {
                height: 225px;
                overflow-y: scroll;
            }
            
    .test1 {
width: 70%;
word-wrap: break-word;
padding: 0.5em;
margin-left:0.5em;
}

.test2 {
width: 70%;
word-wrap: break-word;
padding: 0.5em;
}
   
    </style>
	
	
	
</head>
<body>
<nav class="navbar navbar-fixed-top"
		style="display: flex; align-items: center; justify-content: center; z-index:1000000">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
					aria-expanded="false">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#"> <img src="fblogo.jpg"
					width="20px">
				</a>
			</div>
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<input id="navBarSearch" type="text" value="" name="navBarSearch"
					placeholder="Search People" size="50px" onkeydown="search()"
					style="margin-top: 12px">
				<div class="nav navbar-nav navbar-right">
					<div class="btn-toolbar pull-right" role="toolbar">
						<div class="btn-group" role="group">
							<img id="navBarImg" src="pic.jpg" width="40px" height="40px"
								style="padding: 0px">
							<button id="fbprofile" class="navbar-btn" type="button">Priyank</button>
							<button id="fbhome" class="navbar-btn" type="button">Home</button>
							<button id="find_friend" class="navbar-btn" type="button">Find Friend</button>
							<button class="navbar-btn" type="button">
								<span class="glyphicon glyphicon-user"></span>
							</button>
							<button class="fb-notifications navbar-btn" type="button">
								<span class="glyphicon glyphicon-comment"></span>
							</button>
							<button class="fb-notifications navbar-btn" type="button">
								<span class="glyphicon glyphicon-globe"></span>
							</button>
						</div>
						<div class="btn-group" role="group">
							<div class="dropdown btn-group" role="group">
								<button id="dropbtn1" type="button"
									class="btn btn-default dropdown-toggle navbar-btn"
									data-toggle="dropdown" aria-haspopup="true">
									<span class="glyphicon glyphicon-triangle-bottom"></span>
								</button>
								<ul class="dropdown-menu" aria-labelledby="dropbtn1">
									
									<li><a id="logout" href="#">Log out</a></li>
									
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /.container -->
	</nav>
<div class="row" style="margin-top:60px">

    <!-- This column is for the 3 friend panels-->

    <div class="col-xs-7">
      <div style="margin-left:70px">

      <!-- panel for listing friend suggestions -->

        <div class="fb-status-update-entry panel panel-default" style="max-height: 200px;overflow-y:scroll">
          <div class="panel-body">
            <h4><b>Review your friend suggestions</b></h4>
              <div  id="friendSuggestions" class="row"></div>
            </div>
          </div>
          <!-- panel for listing friend requests -->

         <div class="fb-status-update-entry panel panel-default" style="max-height: 200px;overflow-y:scroll">
          <div class="panel-body">
            <h4><b id="requestCount"></b></h4>
              <div id="requestRows" class="row"></div>
            </div>
          </div>

            <!-- panel for listing people you may know -->

        <div class="fb-status-update-entry panel panel-default" style="max-height: 200px;overflow-y:scroll">
          <div class="panel-body">
            <h4><b >People you may know</b></h4>
              <div  id="peopleYouMayKnowRow" class="row">
               <!--  <div class="media">
                  <div class="col-xs-8">
                    <div class="media-left">
                      <img src="pic.jpg" class="media-object" style="width:40px">
                    </div>
                    <div class="media-body" style="padding-top:10px">
                      <h4 class="media-heading"><a href="#">John Doe</a></h4>
                      <p>iiit-bangalore</p>
                    </div>
                  </div>
                  <div id="buttonCol" class="col-xs-4">
                    <div class="btn-toolbar" role="toolbar" aria-label="..." style="padding-top:15px">
                      <div class="btn-group" role="group" aria-label="..." ><button type="button" class="btn btn-primary btn-sm">Add Friend</button></div>
                      <div class="btn-group" role="group" aria-label="..."><button type="button" class="btn btn-default btn-sm">Remove</button></div>
                    </div>
                  </div>
                </div>-->
              </div>
            </div>
          </div>
      </div>
    </div>

    <!-- this column is for 2 panels for add personal info and search friends-->

  <div class="col-xs-3">

      <div class="panel panel-default">
          <div class="panel-body" style="height:625px">
            <h4><b>Search for friends</b></h4>
             <form name="ffform" id="findfriendform" role="form" method="post">
              <div class="form-group">
                <label for="name">Name:</label>
                <input name="name" type="text" class="form-control" id="find_friend_name">
              </div>
              <div class="form-group">
                <label for="homeTown">Home Town:</label>
                <input name="homeTown" type="text" class="form-control" id="find_friend_homeTown">
              </div>
              <div class="form-group">
                <label for="currentCity">Current City:</label>
                <input name="currentCity" type="text" class="form-control" id="find_friend_currentCity">
              </div>
              <div class="form-group">
                <label for="highSchool">High School:</label>
                <input name="highSchool" type="text" class="form-control" id="find_friend_highSchool">
              </div>
              <div class="form-group">
                <label for="college">College:</label>
                <input name="college" type="text" class="form-control" id="find_friend_college">
              </div>
              <div class="form-group">
                <label for="employer">Employer:</label>
                <input name="employer" type="text" class="form-control" id="find_friend_employer">
              </div>
              <div class="form-group">
                <label for="graduateSchool">Graduate School:</label>
                <input name="graduateSchool" type="text" class="form-control" id="find_friend_graduateSchool">
              </div>
              
              <button type="submit" class="btn btn-default">Submit</button>
            </form>
          </div>
          
          
         </div>
  </div>

  <!-- This column is for the chat room-->

  <div class="col-xs-2" class="panel" style="padding-right:0px;" >
  	<div class="panel-header"></div>
       <div class="panel-body" style="padding-right:0px;">
            <div class="h-scroll" id="chat" style="background-color:white;padding-left:10px;"></div>
       </div>
  </div>
</div>

 <div id="ffModal" class="modal fade" role="dialog" style="z-index: 10000000; height:600px; overflow:auto;">
 <div class="modal-dialog">

   <!-- Modal content-->
   <div class="modal-content" style="z-index: 1000000; height:700px; overflow:auto;">
     <div class="modal-header">
       <button type="button" class="close" data-dismiss="modal">&times;</button>
       <h4 class="modal-title">People Based On Filter</h4>
     </div>
     <div class="modal-body" id="ffModalBody" >
       <p>Some text in the modal.</p>
     </div>
     <div class="modal-footer">
       <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
     </div>
   </div>

 </div>
</div>

</body>

<script>
function search(){
if(event.keyCode==13 && document.getElementById("navBarSearch").value!=''){
	$.ajax({
		type: "get",
		url: "http://localhost:8080/facebook_group6/webapi/users/search?searchData="+document.getElementById("navBarSearch").value+"&from=profile&userId="+sessionStorage.id,
		success: function (response) {
			console.log(response+"profile");			
		}
	});
	window.location.href = "http://localhost:8080/facebook_group6/search.html";
	}
}



var requestCount=0;
document.getElementById("requestCount").innerHTML="You have 0 friend requests";

$("#fbprofile").click(function(){
	 window.location.href="http://localhost:8080/facebook_group6/Profile.html";
	
});

$("#fbhome")
.click(
		function() {

			window.location.href = "http://localhost:8080/facebook_group6/fbHome.html";
		});


$("#logout").click(function(){
	  
	sessionStorage.id = null;
	sessionStorage.fName = null;
	sessionStorage.lName = null;
	sessionStorage.homeTown = null;
	sessionStorage.contact = null;
	sessionStorage.dob = null;
	sessionStorage.mostLikedCity=null;
	   window.location.href = "http://localhost:8080/facebook_group6/fblogin.html";
	});
	
$(document).ready(function(){
	 document.getElementById("fbprofile").innerHTML=sessionStorage.fName;
	 document.getElementById("navBarImg").src="users/"+sessionStorage.id+"/"+sessionStorage.profilePicUrl;
	 popoverFunc();
	
// friend requests lists	
	$.ajax({
		type: "get",
		url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/friendRequest",
		success: function (response) {
	
			console.log(response);
			if(response!=null)
				{ requestCount=response.length;
				document.getElementById("requestCount").innerHTML="respond to "+requestCount+" friend requests";
			for(var i=0;i<response.length;i++)
			{ 
			 var request=response[i];
			
			var requestMedia=document.createElement("div");
			requestMedia.setAttribute("class", "media");
			requestMedia.setAttribute("id","requestMedia_"+request["user_id"]);
			var requestCol=document.createElement("div");
			requestCol.setAttribute("class","col-xs-8");
			
			
			 var divImg=document.createElement("div");
				 divImg.setAttribute("class","media-left");
				 divImg.setAttribute("id","divImageId_"+request["user_id"]);
			     var image=document.createElement("IMG");
				     image.setAttribute("class","media-object");
				     image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
				     image.style.width = "40px";
			     divImg.appendChild(image);
			 
			 var divName=document.createElement("div");
			     divName.setAttribute("class", "media-body");
                 divName.setAttribute("id","divNameId_"+request["user_id"]);
                 divName.style.paddingTop="10px";
                 var heading=document.createElement("H4");
                     heading.setAttribute("class","media-heading");
                     heading.innerHTML=request["first_name"]+" "+request["last_name"];
                 var para=document.createElement("p");
                     para.innerHTML=request["date_of_birth"];
                 divName.appendChild(heading);
                 divName.appendChild(para);
               requestCol.appendChild(divImg);
               requestCol.appendChild(divName);
           
           var buttonCol= document.createElement("div");
           buttonCol.setAttribute("class","col-xs-4");
            var  buttonToolbar=document.createElement("div");
                 buttonToolbar.setAttribute("class", "btn-toolbar");
                 buttonToolbar.setAttribute("role", "toolbar");
                 buttonToolbar.setAttribute("id", "buttonToolbarId_"+request["user_id"]);
                 buttonToolbar.setAttribute("aria-label","...");
                 buttonToolbar.style.paddingTop="15px";
                 
            var  buttonGroup =document.createElement("div");
                 buttonGroup.setAttribute("class","btn-group");
                 buttonGroup.setAttribute("role","group");
                 buttonGroup.setAttribute("aria-label","...");
                  var confirmButton=document.createElement("BUTTON");
                    confirmButton.setAttribute("onClick","friendRequestfunction(this)");
                    confirmButton.setAttribute("id","button_confirmRequest_"+request["user_id"]);
                    confirmButton.setAttribute("class","btn btn-success");
                    confirmButton.innerHTML="Confirm";
					buttonGroup.appendChild(confirmButton);
                 var rejectButton=document.createElement("BUTTON");
                    rejectButton.setAttribute("onClick","friendRequestfunction(this)");
                    rejectButton.setAttribute("id","button_cancelRequest_"+request["user_id"]);
                    rejectButton.setAttribute("class","btn btn-danger");
                    rejectButton.innerHTML="Reject";
					buttonGroup.appendChild(rejectButton);
			buttonToolbar.appendChild(buttonGroup);
			buttonCol.appendChild(buttonToolbar);
			requestMedia.appendChild(requestCol);
			requestMedia.appendChild(buttonCol);
			
			document.getElementById("requestRows").appendChild(requestMedia);
                 
			}
		}
			
		}
		});



// people you may know list

	$.ajax({
		type: "get",
		url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/mutualfriends",
		success: function (response) {
	
			console.log(response);
			if(response!=null)
				{ 
				
			for(var i=0;i<response.length;i++)
			{ 
			 var request=response[i];
			
			var peopleMedia=document.createElement("div");
			peopleMedia.setAttribute("class", "media");
			peopleMedia.setAttribute("id","peopleMedia_"+request["user_id"]);
			var requestCol=document.createElement("div");
			requestCol.setAttribute("class","col-xs-8");
			
			
			 var divImg=document.createElement("div");
				 divImg.setAttribute("class","media-left");
				 divImg.setAttribute("id","divImageId_"+request["user_id"]);
			     var image=document.createElement("IMG");
				     image.setAttribute("class","media-object");
				     image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
				     image.style.width = "40px";
			     divImg.appendChild(image);
			 
			 var divName=document.createElement("div");
			     divName.setAttribute("class", "media-body");
                 divName.setAttribute("id","divNameId_"+request["user_id"]);
                 divName.style.paddingTop="10px";
                 var heading=document.createElement("H4");
                     heading.setAttribute("class","media-heading");
                     heading.innerHTML=request["first_name"]+" "+request["last_name"];
                 var para=document.createElement("p");
                     para.innerHTML=request["date_of_birth"];
                 divName.appendChild(heading);
                 divName.appendChild(para);
               requestCol.appendChild(divImg);
               requestCol.appendChild(divName);
          
               
               
               
               
              /* 
               
               $.ajax({
					type	: "get",
					async	: false,
					url		: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/commonfriends/"+request["user_id"],
					success	: function(innerResponse){
						console.log(innerResponse);
						console.log(innerResponse[0]["user_id"]);
						
						
						var length = innerResponse.length;
						//var display = document.createElement("h5");
						var name;
						var mutualFriends = document.createElement("p");
						mutualFriends.setAttribute("class", "text-muted");
						
						if(length==1)
							{
								name = document.createTextNode(innerResponse[0]["first_name"]+" "+innerResponse[0]["last_name"]);
								mutualFriends.appendChild(name);
							}
						else if(length>1)
							{
								
								name = document.createTextNode(innerResponse[0]["first_name"]+" "+innerResponse[0]["last_name"]+" and ");
								var anc = document.createElement("a");
								
								
					
								
								var len = document.createTextNode((length-1)+" others");
								
								anc.appendChild(len);
								
								var mutualFriendList = "<p>";
								
								for(var j=1;j<innerResponse.length;j++)
									{
									mutualFriendList = mutualFriendList+ innerResponse[j]["first_name"]+" "+innerResponse[j]["last_name"]+"<br>";
									}
								
								mutualFriendList=mutualFriendList+"</p>";
								
								//alert(mutualFriendList);
								
								anc.setAttribute("id","mutualFriendTooltip_"+i);
					              anc.setAttribute("href","#");
					              anc.setAttribute("data-toggle","tooltip");
					              anc.setAttribute("title", mutualFriendList);
					              anc.setAttribute("data-placement","top");
					              anc.setAttribute("data-html","true");
								mutualFriends.appendChild(name);
								mutualFriends.appendChild(anc);
								
							}
		                 divName.appendChild(mutualFriends);
		                 $('[data-toggle="tooltip"]').tooltip();
					}
				});
		*/
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
              
           var buttonCol= document.createElement("div");
           buttonCol.setAttribute("class","col-xs-4");
            var  buttonToolbar=document.createElement("div");
                 buttonToolbar.setAttribute("class", "btn-toolbar");
                 buttonToolbar.setAttribute("role", "toolbar");
                 buttonToolbar.setAttribute("id", "buttonToolbarId_"+request["user_id"]);
                 buttonToolbar.setAttribute("aria-label","...");
                 buttonToolbar.style.paddingTop="15px";
                 
            var  buttonGroup =document.createElement("div");
                 buttonGroup.setAttribute("class","btn-group");
                 buttonGroup.setAttribute("role","group");
                 buttonGroup.setAttribute("aria-label","...");
                  var confirmButton=document.createElement("BUTTON");
                    confirmButton.setAttribute("onClick","peopleYouMayKnowfunction(this)");
                    confirmButton.setAttribute("id","button_addFriend_"+request["user_id"]);
                    confirmButton.setAttribute("class","btn btn-success");
                    confirmButton.innerHTML="Add Friend";
					buttonGroup.appendChild(confirmButton);
                 var rejectButton=document.createElement("BUTTON");
                    rejectButton.setAttribute("onClick","peopleYouMayKnowfunction(this)");
                    rejectButton.setAttribute("id","button_ignore_"+request["user_id"]);
                    rejectButton.setAttribute("class","btn btn-danger");
                    rejectButton.innerHTML="ignore";
					buttonGroup.appendChild(rejectButton);
			buttonToolbar.appendChild(buttonGroup);
			buttonCol.appendChild(buttonToolbar);
			peopleMedia.appendChild(requestCol);
			peopleMedia.appendChild(buttonCol);
			
			document.getElementById("peopleYouMayKnowRow").appendChild(peopleMedia);
                 
			}
		}
			
		}
		});


//friend suggestion list

	$.ajax({
		type: "get",
		url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/getfriendSuggestions",
		success: function (response) {
	
			console.log(response);
			if(response!=null)
				{ 
				
			for(var i=0;i<response.length;i++)
			{ 
			 var request=response[i];
			
			var suggestMedia=document.createElement("div");
			suggestMedia.setAttribute("class", "media");
			suggestMedia.setAttribute("id","suggestMedia_"+request["user_id"]);
			var suggestCol=document.createElement("div");
			suggestCol.setAttribute("class","col-xs-8");
			
			
			 var divImg=document.createElement("div");
				 divImg.setAttribute("class","media-left");
				 divImg.setAttribute("id","divImageId_"+request["user_id"]);
			     var image=document.createElement("IMG");
				     image.setAttribute("class","media-object");
				     image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
				     image.style.width = "40px";
			     divImg.appendChild(image);
			 
			 var divName=document.createElement("div");
			     divName.setAttribute("class", "media-body");
                 divName.setAttribute("id","divNameId_"+request["user_id"]);
                 divName.style.paddingTop="10px";
                 var heading=document.createElement("H4");
                     heading.setAttribute("class","media-heading");
                     heading.innerHTML=request["first_name"]+" "+request["last_name"];
                 var para=document.createElement("p");
                     para.innerHTML=request["date_of_birth"];
                 divName.appendChild(heading);
                 divName.appendChild(para);
                 suggestCol.appendChild(divImg);
                 suggestCol.appendChild(divName);
           
           var buttonCol= document.createElement("div");
           buttonCol.setAttribute("class","col-xs-4");
            var  buttonToolbar=document.createElement("div");
                 buttonToolbar.setAttribute("class", "btn-toolbar");
                 buttonToolbar.setAttribute("role", "toolbar");
                 buttonToolbar.setAttribute("id", "buttonToolbarId_"+request["user_id"]);
                 buttonToolbar.setAttribute("aria-label","...");
                 buttonToolbar.style.paddingTop="15px";
                 
            var  buttonGroup =document.createElement("div");
                 buttonGroup.setAttribute("class","btn-group");
                 buttonGroup.setAttribute("role","group");
                 buttonGroup.setAttribute("aria-label","...");
                  var addButton=document.createElement("BUTTON");
                    addButton.setAttribute("onClick","friendSuggestionfunction(this)");
                    addButton.setAttribute("id","suggestAddButton_addSuggestedFriend_"+request["user_id"]);
                    addButton.setAttribute("class","btn btn-success");
                    addButton.innerHTML="Add Friend";
					buttonGroup.appendChild(addButton);
                 var ignoreButton=document.createElement("BUTTON");
                    ignoreButton.setAttribute("onClick","friendSuggestionfunction(this)");
                    ignoreButton.setAttribute("id","suggestIgnoreButton_ignore_"+request["user_id"]);
                    ignoreButton.setAttribute("class","btn btn-danger");
                    ignoreButton.innerHTML="ignore";
					buttonGroup.appendChild(ignoreButton);
			buttonToolbar.appendChild(buttonGroup);
			buttonCol.appendChild(buttonToolbar);
			suggestMedia.appendChild(suggestCol);
			suggestMedia.appendChild(buttonCol);
			
			
			
			 var title="<div class=\"media\">"+"<div class=\"media-left\">"+
             "<img src=\"users/"+request["user_id"]+"/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:50px;height:50px\">"+
           "</div>"+
           "<div class=\"media-body\" style=\"padding-top:10px\"><h5 class=\"media-heading\"><a href=\"#\">Name: "+request["first_name"]+" "+request["last_name"]+"</a></h5>"+
             "<p>Current City:"+request["current_city"]+"<br>dob: "+request["date_of_birth"]+"</p></div></div>";
         //alert(title);    

    //content : '<div class="media"><a href="#" class="pull-left"><img src="../images/avatar-tiny.jpg" class="media-object" alt="Sample Image"></a><div class="media-body"><h4 class="media-heading">Jhon Carter</h4><p>Excellent Bootstrap popover! I really love it.</p></div></div>'

         var anc = document.createElement("a");
         anc.setAttribute("id","anc_"+request["user_id"]);
         anc.setAttribute("href","#");
         anc.setAttribute("data-toggle","popover");
         anc.setAttribute("data-trigger", "hover");
         anc.setAttribute("data-content", title);
         anc.setAttribute("data-placement","right");
         anc.setAttribute("data-html","true");
        
		anc.appendChild(suggestMedia);	
			document.getElementById("friendSuggestions").appendChild(anc);
			$('[data-toggle="popover"]').popover();    
			}
		}
			
		}
		});






	
});	

function friendRequestfunction(x)
{
var id=(x.id).split('_');

console.log("buttonId"+id[2]);

	

var jsonObject={"user_id":id[2]};
	
	$.ajax({
			type: "put",
			url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/"+id[1],
			contentType: "application/json",
			data: JSON.stringify(jsonObject),
			success: function (response) {
				console.log(response+"profile");
				document.getElementById("requestMedia_"+id[2]).remove();
	            requestCount--;
	            document.getElementById("requestCount").innerHTML="respond to "+requestCount+" friend requests";
	            window.location.reload();
	}
	});


}

function peopleYouMayKnowfunction(x)
{
var id=(x.id).split('_');

console.log("buttonId"+id[2]);

	

var jsonObject={"user_id":id[2]};
	
	if(id[1]=="addFriend"){
	$.ajax({
			type: "put",
			url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/"+id[1],
			contentType: "application/json",
			data: JSON.stringify(jsonObject),
			success: function (response) {
				console.log(response+"profile");
				
	            
	}
	
	});


}
	
		document.getElementById("peopleMedia_"+id[2]).remove();
}

function friendSuggestionfunction(x)
{
	
	
	var id=(x.id).split('_');

	console.log("buttonId"+id[2]);

		

	var jsonObject={"user_id":id[2]};
		
		
		$.ajax({
				type: "put",
				url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/"+id[1],
				contentType: "application/json",
				data: JSON.stringify(jsonObject),
				success: function (response) {
					console.log(response+"profile");
					
		            
		}
		
		});


	
		
			document.getElementById("suggestMedia_"+id[2]).remove();
	
	
}

function popoverFunc() {
    $("#chat").empty();
   
    $
        .ajax({
            type: "get",
            url: "http://localhost:8080/facebook_group6/webapi/users/" + sessionStorage.id + "/friends",
            success: function(response) {
                if (response != null) {
                    console.log(response);
                    for (var i = 0; i < response.length; i++) {
                        var request = response[i];
                        var div = document.createElement("div");
                        div.setAttribute("id", "div_"+request["user_id"]);

                        var name = request["first_name"] + " " + request["last_name"];
                        var dob = request["date_of_birth"];
                        var hometown = request["home_town"];

                        var title = "<div class=\"media\">" + "<div class=\"media-left\">" + "<img src=\"users/" + request["user_id"] + "/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:100px;height:100px\">" + "</div>" + "<div class=\"media-body\" style=\"padding-top:10px\"><h4 class=\"media-heading\"><a href=\"#\">" + name + "</a></h4>" + "<p>" + dob + "<br>" + hometown + "</p></div></div>";
                      

                        var anc = document.createElement("a");
                        anc.setAttribute("id", "anc_frnd_" + request["user_id"]);
                       

                        var img = document.createElement("img");
                        img.setAttribute("src", "users/" + request["user_id"] + "/"+request["profilePicUrl"]);
                        img.setAttribute("id","frnd_pop_"+request["user_id"]+"_"+request["first_name"]);
                        img.style.width = "25px";
                        img.setAttribute("onClick","register_popup(this)");
                       

                        anc.appendChild(img);
                        var id=request["first_name"];
                        var name = document.createElement("a");
                        name.setAttribute("id","frnd_pop_"+request["user_id"]);
                        name.innerHTML=request["first_name"]+" "+request["last_name"]; 
                        //name.setAttribute("href","javascript:register_popup(request.first_name,request.first_name);");
                         name.setAttribute("class","hover");
                         name.setAttribute("data-toggle", "popover");
                         name.setAttribute("data-trigger", "hover");
                         name.setAttribute("onmouseenter","postNamepop(this)");
                       
                       
                        anc.appendChild(name);
                        div.appendChild(anc);
                        document.getElementById("chat")
                            .appendChild(div);

                        var hr = document.createElement("hr");
                        document.getElementById("chat").appendChild(hr);
                      
                    }
                }
            }
        });
}

Array.remove = function(array, from, to) {
var rest = array.slice((to || from) + 1 || array.length);
array.length = from < 0 ? array.length + from : from;
return array.push.apply(array, rest);
}

//this variable represents the total number of popups can be displayed according to the viewport width
var total_popups = 0;

//arrays of popups ids
var popups = [];

//this is used to close a popup
function close_popup(id)
{
console.log("in close "+ id);
for(var iii = 0; iii < popups.length; iii++)
{
   if(id == popups[iii])
   {
    console.log(popups[iii],id);
    
       Array.remove(popups, iii);
       console.log(popups[iii],id);
       
       document.getElementById(id).style.display = "none";
       document.getElementById(id).remove();
       console.log(document.getElementById(id));
       calculate_popups();
       console.log("close end");
       for(var i=0; i<popups.length;i++)
        {
        console.log(popups[i]);
        }
       console.log("close popup");
       return;
   }
}   
}

//displays the popups. Displays based on the maximum number of popups that can be displayed on the current viewport width
function display_popups()
{
console.log("in display popup");
var right = 220;

var iii = 0;
for(iii; iii < total_popups; iii++)
{

   if(popups[iii] != undefined)
   {
    console.log("in popup fn if statament"+ popups[iii]);
       var element = document.getElementById(popups[iii]);
       element.style.right = right + "px";
       right = right + 320;
       element.style.display = "block";
      // console.log(element);
   }
}

for(var jjj = iii; jjj < popups.length; jjj++)
{
   var element = document.getElementById(popups[jjj]);
   element.style.display = "none";
}
console.log("end of display popup");
}


//creates markup for a new popup. Adds the id to popups array.
function register_popup(x)

{
console.log("in rgister function");
var popid= x.id;
console.log(popid);
var temp =x.id.split('_')[2];
var id=temp;
var name = x.id.split('_')[3];
console.log(name);
console.log("id in register "+id);

console.log(popups.length);
//System.out.println("in register function")
for(var iii = 0; iii < popups.length; iii++)
{   
   //already registered. Bring it to front.
   if(id == popups[iii])
   {
    console.log("in if");
       Array.remove(popups, iii);
    console.log(popups.length);
       popups.unshift(id);
       
       calculate_popups();
       
       
       return;
   }
}               

var element = '<div class="popup-box chat-popup" id="'+ id +'">';
element = element + '<div class="popup-head">';
element = element + '<div class="popup-head-left">'+ name +'</div>';
element = element + '<div class="popup-head-right"><a href="javascript:close_popup(\''+ id +'\');">&#10005;</a></div>';
element = element + '<div style="clear: both"></div></div><div  id="popup_messages_'+id+'" class="popup-messages"></div>';
element = element +'<div><input id="chatText_'+id+'"  type="text" onkeyDown="setMessage(this)" style="width:100%;margin-bottom:50px"/></div></div>';
//console.log("in register"+element);
//var pop =document.getElementById("pop_upbox");
//pop.append(element);
//console.log(pop);
console.log(element);
// document.getElementsByTagName("body")[0].innerHTML = document.getElementsByTagName("body")[0].innerHTML + element;
$("body").append(element);
//console.log(document.getElementsByTagName("body")[0].innerHTML);
popups.unshift(id);
console.log("popups"+popups.length);
       
calculate_popups();
console.log("end of from regster");

// document.getElementById("popup_messages_"+id).appendChild(document.createTextNode("hello"));


$.ajax({
type : "get",
url : "http://localhost:8080/facebook_group6/webapi/userMessages/getTextMessages/"+sessionStorage.id+"/"+id,
success : function(data) {

if(data)
{
var len=data.length;
for(var i=0;i<len;i++)
{
var message=data[i];
if(message.sender_id==sessionStorage.id)
createDiv(message.message,"alert alert-success  test1 pull-left","popup_messages_"+id,id);
else
createDiv(message.message,"alert alert-success test1 pull-right","popup_messages_"+id,id);
}
}
//createDiv($('#chatText_'+id).val(),"alert alert-success test1 pull-left","popup_messages_"+id,id);

}
});



}
function setMessage(x)
{
var id1 = (x.id).split("_");
if (x.value != "" && event.keyCode == 13)
{
var obj={"sender_id":sessionStorage.id,"receiver_id":id1[1],"message":document.getElementById(x.id).value}
$.ajax({
type : 'PUT',
data : JSON.stringify(obj),
contentType:"application/json",
url : "http://localhost:8080/facebook_group6/webapi/userMessages/sendTextMessages",
success : function(data) {

if(data)
{
createDiv(data.message,"alert alert-success test1 pull-left","popup_messages_"+id1[1],id1[1]);
document.getElementById(x.id).value='';
}
//createDiv($('#chatText_'+id).val(),"alert alert-success test1 pull-left","popup_messages_"+id,id);

}
});
}
}

function createDiv(message,cl,id1,id2){
var Div_1 = document.createElement('div');
Div_1.className = cl;
var para=document.createElement('p');
var node = document.createTextNode(message);
para.appendChild(node);
Div_1.appendChild(para);
var element = document.getElementById(id1);
element.appendChild(Div_1);
var objDiv = document.getElementById(id1);
objDiv.scrollTop = objDiv.scrollHeight;
}




//calculate the total number of popups suitable and then populate the toatal_popups variable.
function calculate_popups()
{
var width = window.innerWidth;
if(width < 540)
{
   total_popups = 0;
}
else
{
   width = width - 200;
   //320 is width of a single popup box
   total_popups = parseInt(width/320);
}
console.log("hello"+total_popups);
display_popups();

}

//recalculate when window is loaded and also when window is resized.
window.addEventListener("resize", calculate_popups);
window.addEventListener("load", calculate_popups);

/*--------------------------------------pop over function-------------------------------------------------  */
function fun() {

var element = $(this);
var id = element.attr("id");
//alert(id);
$(".hover").popover({
content : fetchdata1,
html : true,
placement:"top"
});
}

function fetchdata1() {

var friendList = "<p>";
var element = $(this);
var pid = element.attr("id");
var ido = pid.split('_');
console.log(ido);
$.ajax({
url : "http://localhost:8080/facebook_group6/webapi/users/"
+ ido[2],
method : "GET",
async : false,
//contentType: 'application/json',

success : function(request) {
console.log(request);
var name = request["first_name"] + " "
+ request["last_name"];
var dob = request["date_of_birth"];
var hometown = request["home_town"];


friendList = friendList + "<div class=\"media\">"
+ "<div class=\"media-left\">"
+ "<img src=\"users/"+request["user_id"]+"/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:100px;height:100px\">"
+ "</div>"
+ "<div class=\"media-body\" style=\"padding-top:10px\"><h4 class=\"media-heading\"><a href=\"#\">"
+ name + "</a></h4>" + "<p>" + dob
+ "<br>" + hometown
+ "</p></div></div>";
}
//return fetch_data;
});
console.log(friendList);
return friendList;
}


/*--------------------------------------pop over function-------------------------------------------------  */
/*--------------------------------------chat box-------------------------------------------------  */
function postNamepop(x){

var element=$(x);
var id=element.attr("id");
console.log(id);
$(".hover").popover({
content:fetchNameim,
html:true,
placement:'left'
});
}


function fetchNameim(){
console.log("hello");
var friendList="<p>";
var element=$(this);
var pid=element.attr("id");
var ido = pid.split('_');
//console.log(ido[2]);;
$.ajax({
url:"http://localhost:8080/facebook_group6/webapi/users/"+ido[2],
method:"GET",
async:false,
//contentType: 'application/json',
   
   success: function(request){
    var name = request["first_name"]+" "+request["last_name"];
             var dob = request["date_of_birth"];
             var hometown = request["home_town"];
    friendList=friendList+"<div class=\"media\">"+"<div class=\"media-left\">"+
                 "<img src=\"users/"+request["user_id"]+"/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:100px;height:100px\">"+
               "</div>"+
               "<div class=\"media-body\" style=\"padding-top:10px\"><h4 class=\"media-heading\"><a href=\"#\">"+name+"</a></h4>"+
                 "<p>"+dob+"<br>"+hometown+"</p></div></div>";
  //friendList = friendList+"First Name :"+data.first_name+"<br>"+"Last Name :"+data.last_name+"<br>"+"City :"+data.home_town+"<br>"+"Date Of birth:"+data.date_of_birth;

   }

});
console.log(friendList);
return friendList;
}



/*-------------------------------------------------filter on friend review suggestion box------------------------------------------  */

 
function selectPopOverFunc()
{   
$("#friendSuggestions").empty();
//$('[data-toggle="popover"]').popover();
    
 var e = document.getElementById("filter");
    var option= e.options[e.selectedIndex].value;
   
    $.ajax({
    type  : "get",
        url   : "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/getfriendSuggestionsOnCity/"+option,
        success: function(response){     
          if(response!=null)
          {
        console.log(response);
            for(var i=0;i<response.length;i++)
            {
              var request = response[i];
              var div = document.createElement("div");
              div.setAttribute("id",request["user_id"]);
              
              var name = request["first_name"]+" "+request["last_name"];
              var dob = request["date_of_birth"];
              var likedCity = request["mostLikedCity"];
              console.log(likedCity);
              var title="<div class=\"media\">"+"<div class=\"media-left\">"+
                  "<img src=\"users/"+request["user_id"]+"/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:50px;height:50px\">"+
                "</div>"+
                "<div class=\"media-body\" style=\"padding-top:10px\"><h5 class=\"media-heading\"><a href=\"#\">"+name+"</a></h5>"+
                  "<p>"+likedCity+"<br>"+dob+"</p></div></div>";
              //alert(title);    

         //content : '<div class="media"><a href="#" class="pull-left"><img src="../images/avatar-tiny.jpg" class="media-object" alt="Sample Image"></a><div class="media-body"><h4 class="media-heading">Jhon Carter</h4><p>Excellent Bootstrap popover! I really love it.</p></div></div>'

              var anc = document.createElement("a");
              anc.setAttribute("id","anc_"+request["user_id"]);
              anc.setAttribute("href","#");
              anc.setAttribute("data-toggle","popover");
              anc.setAttribute("data-trigger", "hover");
              anc.setAttribute("data-content", title);
              anc.setAttribute("data-placement","right");
              anc.setAttribute("data-html","true");
             
            /*   var img = document.createElement("img");
              img.setAttribute("src","users/"+request["user_id"]+"/profilePic.jpg");
              img.style.width = "25px";

              anc.appendChild(img);
             
              var name = document.createTextNode(request["first_name"]+" "+request["last_name"]);
              anc.appendChild(name);
              div.appendChild(anc);
              
                         
              
 */           
 
 
 var suggestMedia=document.createElement("div");
	suggestMedia.setAttribute("class", "media");
	suggestMedia.setAttribute("id","suggestMedia_"+request["user_id"]);
	var suggestCol=document.createElement("div");
	suggestCol.setAttribute("class","col-xs-8");
	
	
	 var divImg=document.createElement("div");
		 divImg.setAttribute("class","media-left");
		 divImg.setAttribute("id","divImageId_"+request["user_id"]);
	     var image=document.createElement("IMG");
		     image.setAttribute("class","media-object");
		     image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
		     image.style.width = "40px";
	     divImg.appendChild(image);
	 
	 var divName=document.createElement("div");
	     divName.setAttribute("class", "media-body");
      divName.setAttribute("id","divNameId_"+request["user_id"]);
      divName.style.paddingTop="10px";
      var heading=document.createElement("H4");
          heading.setAttribute("class","media-heading");
          heading.innerHTML=request["first_name"]+" "+request["last_name"];
      var para=document.createElement("p");
          para.innerHTML=request["date_of_birth"];
      divName.appendChild(heading);
      divName.appendChild(para);
      suggestCol.appendChild(divImg);
      suggestCol.appendChild(divName);

var buttonCol= document.createElement("div");
buttonCol.setAttribute("class","col-xs-4");
 var  buttonToolbar=document.createElement("div");
      buttonToolbar.setAttribute("class", "btn-toolbar");
      buttonToolbar.setAttribute("role", "toolbar");
      buttonToolbar.setAttribute("id", "buttonToolbarId_"+request["user_id"]);
      buttonToolbar.setAttribute("aria-label","...");
      buttonToolbar.style.paddingTop="15px";
      
 var  buttonGroup =document.createElement("div");
      buttonGroup.setAttribute("class","btn-group");
      buttonGroup.setAttribute("role","group");
      buttonGroup.setAttribute("aria-label","...");
       var addButton=document.createElement("BUTTON");
         addButton.setAttribute("onClick","friendSuggestionfunction(this)");
         addButton.setAttribute("id","suggestAddButton_addSuggestedFriend_"+request["user_id"]);
         addButton.setAttribute("class","btn btn-success");
         addButton.innerHTML="Add Friend";
			buttonGroup.appendChild(addButton);
      var ignoreButton=document.createElement("BUTTON");
         ignoreButton.setAttribute("onClick","friendSuggestionfunction(this)");
         ignoreButton.setAttribute("id","suggestIgnoreButton_ignore_"+request["user_id"]);
         ignoreButton.setAttribute("class","btn btn-danger");
         ignoreButton.innerHTML="ignore";
			buttonGroup.appendChild(ignoreButton);
	buttonToolbar.appendChild(buttonGroup);
	buttonCol.appendChild(buttonToolbar);
	suggestMedia.appendChild(suggestCol);
	suggestMedia.appendChild(buttonCol);

 
 
 anc.appendChild(suggestMedia);
 
 
 
 
 
 
 document.getElementById("friendSuggestions").appendChild(anc);

              var hr = document.createElement("hr");
              document.getElementById("chat").appendChild(hr);
              $('[data-toggle="popover"]').popover();
            }
          }
        }
      });
}
 
var formF = $('#findfriendform');
formF.submit(function(){
$('#ffModal').modal('show')
$('#ffModalBody').empty();
   $.ajax({
     type: formF.attr('method'),
     url: "http://localhost:8080/facebook_group6/webapi/users/" + sessionStorage.id + "/findFriends",
     data: formF.serialize(),
     success : function(response){
     console.log(response);
         for(var i = 0; i<response.length ; i++){
         
           var request = response[i];
       
        if(sessionStorage.id == request["user_id"]){
        continue;
        }
        
           var findFriendMedia =  document.createElement("div");
           
           findFriendMedia.setAttribute("class","media");
           findFriendMedia.setAttribute("id","findFriendMedia_"+request["user_id"]);
           
           var mediaLeftDiv = document.createElement("div");
           mediaLeftDiv.setAttribute("class","col-xs-5");

           var divImage = document.createElement("div");
           divImage.setAttribute("class","media-left");
           divImage.setAttribute("id","divImageId_"+request["user_id"]);


           var image = document.createElement("img");
           image.setAttribute("class","media-object");
           image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
           image.style.width = "40px";
           divImage.appendChild(image);
           mediaLeftDiv.appendChild(divImage);

           var divName = document.createElement("div");
           divName.setAttribute("class","media-body");
           divName.setAttribute("id","divNameId_"+request["user_id"]);

           var heading = document.createElement("h4");
           heading.setAttribute("class","media-heading");
           heading.innerHTML=request["first_name"]+" "+request["last_name"];
           divName.appendChild(heading);
           mediaLeftDiv.appendChild(divName);


           var addFindFriendButton = document.createElement("button");
           addFindFriendButton.setAttribute("id","button_addFriend_"+request["user_id"]);
           addFindFriendButton.setAttribute("class","btn btn-success");
           addFindFriendButton.setAttribute("onClick","findFriendRequestFunction(this)");
           addFindFriendButton.innerHTML="Add Friend";

           var buttonCol = document.createElement("div");
           buttonCol.setAttribute("class","col-xs-3");
           buttonCol.appendChild(addFindFriendButton);
           findFriendMedia.appendChild(mediaLeftDiv);
           findFriendMedia.appendChild(buttonCol);
           
           document.getElementById("ffModalBody").appendChild(findFriendMedia);
         }

     }
     
   });
   return false;
 
});
////////////////////////////////////////////********END************************


function findFriendRequestFunction(x)
{
var id=(x.id).split('_');

console.log("buttonId"+id[2]);

 

var jsonObject={"user_id":id[2]};

 $.ajax({
     type: "put",
     url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/"+id[1],
     contentType: "application/json",
     data: JSON.stringify(jsonObject),
     success: function (response) {
       console.log(response+"profile");
       
             
   }
 
 });
 document.getElementById("findFriendMedia_"+id[2]).remove();
}

</script>
</html>