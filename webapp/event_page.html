<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="fbhome.css">
</head>
<body>
<nav class="navbar navbar-fixed-top navbar-default" style="z-index:100000">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">
        <img src="fblogo.jpg" width="20px"></span>
      </a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <input id="navBarSearch" type="text" value="" name="navBarSearch"
			placeholder="Search People" size="50px" onkeydown="search()" style="margin-top: 12px">
      <div class="nav navbar-nav navbar-right">	
  	<div class="btn-toolbar pull-right" role="toolbar" style="margin-top:5px">
	    <div class="btn-group" role="group">
	      <img id="navPic" src="pic.jpg" width="25px"> 
	      <button id="profile" class="navbar-btn" type="button">Priyank</button>
	      <button id="home" class="navbar-btn" type="button">Home</button>
	      <button class="navbar-btn" type="button">
	          <span class="glyphicon glyphicon-user"></span>
	      </button>
	      <button class="fb-notifications navbar-btn" type="button">
	          <span class="glyphicon glyphicon-comment"></span>
	      </button>
	      <button class="fb-notifications navbar-btn" type="button">
	          <span class="glyphicon glyphicon-globe"></span>
	      </button>
	    </div>
	    <div class="btn-group" role="group">
	      <div class="dropdown btn-group" role="group">
	        <button id="dropbtn1" type="button" class="btn btn-default dropdown-toggle navbar-btn" data-toggle="dropdown" aria-haspopup="true">
	        	<span class="glyphicon glyphicon-triangle-bottom"></span>
	        </button>
	        <ul class="dropdown-menu" aria-labelledby="dropbtn1">
	         
	          <li><a id="logout" href="#">Log out</a></li>
	        </ul>
	      </div>
	    </div>
	  </div>
  </div>
    </div>
  </div><!-- /.container -->
</nav>

<div class="row" style="margin-top:70px">
  <div class="col-xs-2">
    <ul class="nav nav-pills nav-stacked" style="float:right">
      <div class="row">
        <div class="col-xs-3"><img id="profilePic" src="pic.jpg" style="width:30px"></div>
        <div class="col-xs-9"><a id="profileFullName" href="#">Priyank Sharma</a><a href="#" style="font-size:12px"><br>Edit Profile</a></div>
      </div>
      <li style="margin-top:20px;margin-bottom:10px"><span>MY EVENTS</span></li>
      <li><a href="#" data-toggle="modal" data-target="#createEventModal" style="padding:0px;margin-left:15px">
      		<span class="glyphicon glyphicon-plus-sign"></span> Create</a></li>
    </ul>  
  </div>

  <div class="col-xs-5">

    <div class="event panel panel-default" style="margin-top:10px;">
        <div class="panel-body" style="padding:0px">
          <div>
            <img src="backgroundImage.jpg" width="100%" height="250px">
          </div>
          <div class="row">
            <div class="col-xs-5" style="padding:10px;padding-left:30px">
              Starts on- <h4 id="start_date_1">March 25th</h4>
            </div>
            <div class="col-xs-7" style="padding:10px;padding-left:30px">
              <span id="event_name_1" style="font-size:20px;color:#3b5999">Music Is Our Mantra Presents HillTop Night Ft Tristan</span>
             <br>Hosted by <a id="hosted_by_1" href="#">Someone</a> 
            </div>
          </div>
          <div class="btn-group" role="group" style="padding-left:20px">
            <button type="button" class="btn btn-primary disabled" style="border:1px solid "><span class="glyphicon glyphicon-ok"></span><span id="status"> Going</span></button>
          </div> 
          <div class="media"  style="padding-left:20px">
            <div class="media-left media-middle">
              <span class="glyphicon glyphicon-time"></span>
            </div>
            <div class="media-right media-middle">Starts: <b><span id="start_date_2">25th March</span></b> - Ends: <b><span id="end_date_1">25th April</span></b></div>
          </div>
          <div class="media" style="padding-left:20px">
            <div class="media-left media-middle">
              <span class="glyphicon glyphicon-map-marker"></span>
            </div>
            <div class="media-right media-middle"><b><span id="location_1">Pebble Palace</span></b></div>
          </div>
          </div><br>
      </div>
      
      <!-- event create modal -->
      <div id="createEventModal" class="modal fade" role="dialog" style="z-index:1000000">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Create a New Event</h4>
				</div>
				<div class="modal-body">
				Basic information about your event	
					<form class="form" id="createEvent" method="post">
						<div class="form-group" style="padding:40px">	
							<div>	
								<b style="margin-right:50px">Event Name</b>
								<input id="eventName" name="event_name" type="text" placeholder="  Enter Event Name" style="width:300px;float:right">
							</div><br>
							<div>	
								<b style="margin-right:50px">Location</b>
								<input id="eventLoc" name="location" type="text" placeholder="  Enter event venue" style="width:300px;float:right">
							</div><br>
							<div>	
								<b style="margin-right:50px">Start Date</b>
								<input type="date" name="start_date" id="eventStart" name="dob" style="width:300px;float:right">
							</div><br>
							<div>	
								<b style="margin-right:50px">End Date</b>
								<input type="date" name="end_date" id="eventEnd" name="dob" style="width:300px;float:right">
							</div><br>
							<div>	
								<b style="margin-right:50px">Description</b>
								<input type="textArea" name="description" id="eventDesc" placeholder=" Add a description" name="dob" style="width:300px;float:right"
									style="resize:none">
							</div><br>
							<input type="submit" value="Submit" class="btn btn-warning" />		
						</div>
					</form>
				</div>
            	<div class="modal-footer"></div>
			</div>
		</div>
	</div>
	
	<!-- upload photo pic -->
	<div id="uploadPhotoModal" class="modal fade" role="dialog">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Upload Photo</h4>
						</div>
						<div class="modal-body">
							<form id="uploadPic"
								action="http://localhost:8080/facebook_group6/webapi/users/uploadImage"
								method="post" enctype="multipart/form-data">
								<p id="uploadPhoto">
									Select a file : <input type="file" name="file" size="45"
										class="btn btn-success" />
								</p>
								<input type="text" name="userId" id="PhotoId"
									value="anupam.awasthi1@gmail.com" style="display: none;">
								<input type="submit" value="Upload It" class="btn btn-warning" />
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>
			
			<div class="modal fade" id="eventInviteModal" role="dialog">
        		<div class="modal-dialog">
		          <!-- Modal content-->
		          <div class="modal-content">
		            <div class="modal-header">
		              <button type="button" class="close" data-dismiss="modal">&times;</button>
		              <h4 class="modal-title">Invite Friends</h4>
		            </div>
		            <div id="eventInviteModalBody" class="modal-body"></div>
		            <div class="modal-footer">
		              <button type="button" class="btn btn-default"
		                data-dismiss="modal">Close</button>
		            </div>
		          </div>

        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-body"><b style="font-size:18px">Details</b><hr style="padding:0px;margin:5px">
          <div>
            <h4><b id="event_name_2" style="color:#3b5999">default event name</b></h4>
          </div>
          <div style="font-size:14px">
          		Starts at - <span id="start_date_3">default start date</span><br>
           		Event managed by - <a href="#" id="hosted_by_2">default hosted by</a><br> 
           		Venue - <span id="location_2">default location</span>
          </div><hr>
          <h4 id="description">This is one of the most popular event in your area.</h4>
        </div>
      </div>
      
      <div class="event_posts panel panel-default">
        <div class="panel-body">
          <div>
            <a href="#"><b id="goingCount">0 going</b></a> . <a href="#" id="hoverOnInterested" class="hover" data-placement="auto" data-html="true" data-toggle="tooltip"><b id="intrestedCount">0 interested</b></a>
            <button id="invite" type="btn btn-secondary" style="float:right" onclick="inviteFriends(this)">Invite</button>
          </div>
          <h5 style="color:#999999">Invite your friends to this event</h5>
        </div>
      </div>
      
      <!-- Event posts panel -->
      <div class="panel panel-default" style="margin-top:20px">
            	<ul class="nav nav-tabs">
            		<li class="nav-item">
              			<a class="nav-link"><span class="glyphicon glyphicon-pencil"></span> Write post</a>
            		</li>
          		</ul>
          		<div class="panel-body">   
            		<form  method="post"  id="post_form" enctype="multipart/form-data">
						<div class="row">
	 						<a href="#"><span class="glyphicon glyphicon-camera"></span><label  for="files"> Upload Photo</label></a>
							<input type="file" name="file" id="file_data"/>
							<input type="text" name= "user_name" id="user_name" style="display:none" />
							<div class="col-md-2"><img id="postPic" src="pic.jpg" class="img-circle" width="100%"/></div>   
	  						<div class="col-md-10"><textarea name="postdata" class="form-control" id="feedbox" rows="3"></textarea><br>
	  							<button type="submit" class="btn btn-primary" >Post</button>
	 					    </div>
						</div>
					</form>    
          		</div>    <!-- panel body ends -->
        	</div>    <!-- group panel ends -->
        
        	<div id="postCol">  <!--Group posts --></div>
    </div>
</div>
</body>

<script>

$(document).on("mouseenter", "[id^=hoverOnInterested]", function() {

    //var element = $(this);
    //var id = element.attr("id");
    //alert(id);
    //alert("in hovers");
    $(".hover").tooltip({
        title: fetchmembers,
        html: true
    })
});

function fetchmembers() {

//alert("in fetch members");
    var friendList = "<p>";
    //var element = $(this);
    //var pid = element.attr("id");
    //var ido = pid.split('_');
    //console.log(ido);;
    $.ajax({
    type: "get",
        url: "http://localhost:8080/facebook_group6/webapi/users/events/Interestedmembers/" +sessionStorage.event_id ,
       
        async: false,
        //contentType: 'application/json',
        success: function(data) {
                console.log(data);
                var length = data.length;

                for (var j = 0; j < length; j++) {
                   
                        friendList = friendList + data[j].first_name +" "+ data[j].last_name+"<br>";
                }
            }
            //return fetch_data;
    })
    console.log(friendList);
    return friendList;
}




var form = $('#post_form');
form.submit(function () {
	var fd = new FormData($('#post_form')[0]);
	console.info(fd);
	$.ajax({
		type: form.attr('method'),
		url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/events/"+sessionStorage.event_id+"/posts",
		data : fd,
		enctype : 'multipart/form-data',
		processData : false, // Important!
		contentType : false,
		cache : false,
		success: function (data) { 
			setTimeout(function(){window.location.reload();},5000); 
		} 
	});
	return false; 
});

$(document).ready(function(){
	if(sessionStorage.id=="null")
		window.location.href = "http://localhost:8080/facebook_group6/fblogin.html";		    
	else{
		popoverFunc();
		countGoingAndInterested();
		document.getElementById("profile").innerHTML=sessionStorage.fName;
		document.getElementById("navBarSearch").value='';
		document.getElementById("profileFullName").innerHTML=sessionStorage.fName+" "+sessionStorage.lName;
		document.getElementById("navPic").src="users/"+sessionStorage.id+"/"+sessionStorage.profilePicUrl;
		document.getElementById("profilePic").src="users/"+sessionStorage.id+"/"+sessionStorage.profilePicUrl;
		document.getElementById("postPic").src="users/"+sessionStorage.id+"/"+sessionStorage.profilePicUrl;
		document.getElementById("status").innerHTML=" "+sessionStorage.status;
		document.getElementById("event_name_1").innerHTML="<h3>"+sessionStorage.event_name+"</h3>";
		document.getElementById("event_name_2").innerHTML=sessionStorage.event_name;
		document.getElementById("location_1").innerHTML=sessionStorage.location;
		document.getElementById("location_2").innerHTML=sessionStorage.location;
		document.getElementById("hosted_by_1").innerHTML=sessionStorage.hosted_by;
		document.getElementById("hosted_by_2").innerHTML=sessionStorage.hosted_by;
		document.getElementById("start_date_1").innerHTML=sessionStorage.start_date;
		document.getElementById("start_date_2").innerHTML=sessionStorage.start_date;
		document.getElementById("start_date_3").innerHTML=sessionStorage.start_date;
		document.getElementById("end_date_1").innerHTML=sessionStorage.end_date;
		document.getElementById("description").innerHTML=sessionStorage.description;
						
		<!-- post ajax -->
		$.ajax({
			type: "get",
			contentType:"application/json",
			url: "http://localhost:8080/facebook_group6/webapi/events/"+sessionStorage.event_id+"/posts",
			success: function (response) {
				for(var j=0;j<response.length;j++){
					var post=response[j]; 
					console.log(post);
					var postPanel=document.createElement("div");
					postPanel.setAttribute("class","panel panel-default");
					postPanel.setAttribute("id","postPanel_"+post["post_id"]);   
					var postPanelBody=document.createElement("div");
			       	postPanelBody.setAttribute("class","panel-body");
					postPanelBody.setAttribute("id","postPanelBody_"+post["post_id"]);

					var postMedia=document.createElement("div");
		 			postMedia.setAttribute("class", "media");
		 			postMedia.setAttribute("id","postMedia_"+post["post_id"]);

					var divImg=document.createElement("div");
					divImg.setAttribute("class","media-left");
					divImg.setAttribute("id","divImageId_"+post["post_id"]);
					var image=document.createElement("IMG");
					image.setAttribute("class","media-object");
					console.log(post["profilePicUrl"]);
					image.setAttribute("src","users/"+post["user_id"]+"/"+post["profilePicUrl"]);
					image.style.width = "25px";
					divImg.appendChild(image);

					var divName=document.createElement("div");
		 			divName.setAttribute("class", "media-body");
		            divName.setAttribute("id","divNameId_"+post["post_id"]);
		            divName.style.paddingTop="1px";
		         	
		            var heading=document.createElement("H4");
		            heading.setAttribute("class","media-heading");
		            heading.innerHTML=post["fullName"];
		         	
		            var para=document.createElement("p");
		            para.innerHTML=post["post_date_time"];
		            divName.appendChild(heading);
		        	divName.appendChild(para);
		      		postMedia.appendChild(divImg);
		      		postMedia.appendChild(divName);
					postPanelBody.appendChild(postMedia);      
					postPanel.appendChild(postPanelBody);
					
					var postData=post["post_data"];
		    		if(postData["post_data_message"]){   
		    		var postDataText=document.createElement("p");
		    		postDataText.innerHTML=postData["post_data_message"];
		    		postPanelBody.appendChild(postDataText);
				}
		                     
		    	if(postData["postImage"]){
		    		var postDataImage=document.createElement("IMG");
		       		postDataImage.style.height="200px";
		       		postDataImage.style.widht="200px";
		       		postDataImage.setAttribute("src","users/"+post["user_id"]+"/images/"+postData["postImage"]);
		       		postPanelBody.appendChild(postDataImage);
		  		}

				var postPanelFooter1=document.createElement("div");
				postPanelFooter1.setAttribute("class","panel-footer");
				//postPanelFooter1.style.display="inline";        
		      
		 		var postCommentLink=document.createElement("a");    
		 		postCommentLink.setAttribute("id","postCommentLink_"+post["post_id"]);
		    	postCommentLink.setAttribute("onClick","getCommentsLinkFunction(this)");
		   		//postCommentLink.setAttribute("href","getCommentsLinkFunction(this)");
		    	//postCommentLink.setAttribute("data-toggle","collapse");
		     	//postCommentLink.setAttribute("href","#commentsOnPost_"+post["post_id"]);
		     	postCommentLink.style.paddingLeft="10px";
		     	var postShare=document.createElement("a");
		     	postShare.setAttribute("id","postShare_"+post["post_id"]);
		     	postShare.setAttribute("href","#");
		    	// postShare.setAttribute("onClick","postShareFunction(this)");
		     	postShare.innerHTML="Share";
		     	postShare.style.paddingLeft="10px";
		    
		     	postPanelFooter1.appendChild(postCommentLink);
		     	postPanelFooter1.appendChild(postShare);
		     	postPanel.appendChild(postPanelFooter1);

				var postPanelFooter2=document.createElement("div");     
		    	postPanelFooter2.setAttribute("class","panel-footer collapse");
		   		// postPanelFooter2.setAttribute("id","postLikeCounts_"+post["post_id"]);
		    	postPanelFooter2.style.display="block";
		    	var postLikeCounts=document.createElement("div");
		        postLikeCounts.setAttribute("id","postLikeCounts_"+post["post_id"]);
		        postLikeCounts.style.display="none";
		    	postPanelFooter2.appendChild(postLikeCounts);
		 		var likes=post["listOfProfile"];
		     	if(likes.length==1 && (likes[0])["user_id"]==sessionStorage.id){
		     		var postLike=document.createElement("a");
		     		postLike.setAttribute("onClick","postLikeFunction(this)");
					//postLike.setAttribute("href","#");
		     		postLike.style.paddingLeft="10px";
		     		postLike.innerHTML="Unlike";
		     		postLike.setAttribute("id","postUnlike_"+post["post_id"]);
		     		postPanelFooter1.appendChild(postLike);
		     
		     		var p=document.createElement("p");
		     		p.innerHTML="You Like this";
		     		postLikeCounts.appendChild(p);
		     		postLikeCounts.style.display="block";
		     	}
		     	else if(likes.length==1){ 
		            var postLike=document.createElement("a");
		     		postLike.setAttribute("onClick","postLikeFunction(this)");
					//postLike.setAttribute("href","#");
		     		postLike.style.paddingLeft="10px";
		     		postLike.innerHTML="Like";
		     		postLike.setAttribute("id","postLike_"+post["post_id"]);
		     		postPanelFooter1.appendChild(postLike);
		     
			        var a=document.createElement("a");
		     		var p=document.createElement("p");
		     		p.innerHTML=" liked this";
		     		a.setAttribute("id","postLikesCountLink_"+post["post_id"]);
		     		a.innerHTML=(likes[0])["first_name"];
		    		p.prepend(a);
		    		postLikeCounts.appendChild(p);
		    		postLikeCounts.style.display="block";
		     	}
		     	else if(likes.length>1) {
		     	   	var i=0;        
		     		for(i=0;i<likes.length;i++){
		       			if((likes[i])["user_id"]==sessionStorage.id){  
		        			var postLike=document.createElement("a");
		     				postLike.setAttribute("onClick","postLikeFunction(this)");
							//postLike.setAttribute("href","#");
		     				postLike.style.paddingLeft="10px";
		     				postLike.innerHTML="Unlike";
		     				postLike.setAttribute("id","postUnlike_"+post["post_id"]);
		     				postPanelFooter1.appendChild(postLike);
		                  	var p=document.createElement("p");
		                    p.innerHTML="You and ";
		                    var a=document.createElement("a");
		                    if(likes.length-1==1)
		                             a.innerHTML=(likes.length-1)+" other ";
		                        else
		                             a.innerHTML=(likes.length-1)+" others ";
		                        a.setAttribute("id","postLikesCountLink_"+post["post_id"]);
		                        p.appendChild(a);
		                        // var p1=document.createElement("p");
		                        // p1.innerHTML="liked this";
		                        p.appendChild(document.createTextNode("liked this"));
		                        postLikeCounts.appendChild(p);
		       	 				postLikeCounts.style.display="block";
		                        break;
		       				}
		     			}
		    			if(i==likes.length){
		    				var postLike=document.createElement("a");
		     				postLike.setAttribute("onClick","postLikeFunction(this)");
								//postLike.setAttribute("href","#");
		     				postLike.style.paddingLeft="10px";
		     				postLike.innerHTML="Like";
		     				postLike.setAttribute("id","postLike_"+post["post_id"]);
		     				postPanelFooter1.appendChild(postLike);
		         
		    				var p=document.createElement("p");
		                    p.innerHTML=(likes[0])["first_name"]+" and ";
		                    var a=document.createElement("a");
		                    if(likes.length-1==1)
		                    	a.innerHTML=(likes.length-1)+" other ";
		                    else
		                        a.innerHTML=(likes.length-1)+" others ";
		                    a.setAttribute("id","postLikesCountLink_"+post["post_id"]);
		                    p.appendChild(a);
		                    var p1=document.createElement("p");
		                           
		                    p.appendChild(document.createTextNode("liked this"));
		                    postLikeCounts.appendChild(p);
		   	 				postLikeCounts.style.display="block";
		    			}
		     		}
		     		else{
		     			var postLike=document.createElement("a");
		     			postLike.setAttribute("onClick","postLikeFunction(this)");
		   				//  postLike.setAttribute("href","#");
		     			postLike.style.paddingLeft="10px";
			            postLike.innerHTML="Like";
		     			postLike.setAttribute("id","postLike_"+post["post_id"]);
		     			postPanelFooter1.appendChild(postLike);
		     		}

					var commentsOnPost=document.createElement("div");    
		    		commentsOnPost.setAttribute("id","commentsOnPost_"+post["post_id"]);
		    		postPanelFooter2.appendChild(commentsOnPost);

			 			var postComment=document.createElement("div");
		    		postComment.setAttribute("id","postComment_"+post["post_id"]);
		     		var postCommentInput=document.createElement("INPUT");
		            postCommentInput.setAttribute("type", "text");
		            postCommentInput.setAttribute("placeholder","Write Here!");
		            postCommentInput.setAttribute("id","postCommentInput_"+post["post_id"]);
		            postCommentInput.setAttribute("onkeydown","postCommentFunction(this)");
		            postCommentInput.setAttribute("value","");
		            postCommentInput.style.width="90%";
		            postComment.appendChild(postCommentInput);
		            postPanelFooter2.appendChild(postComment);     
		            postPanel.appendChild(postPanelFooter2);              
		            document.getElementById("postCol").appendChild(postPanel);

		    		//--------comments count------------
		  			var commentsCount=0;
		    		$.ajax({
						type: "get",
						async:false,
						url: "http://localhost:8080/facebook_group6/webapi/comments/"+post["post_id"],
						contentType: "application/json",
						success: function (response) {
							commentsCount=response.length;
						}
		   			});
		    
		    		if(commentsCount>0)
		    			postCommentLink.innerHTML="View "+commentsCount+" Comments";      
					//alert(postCommentLink.innerHTML);
				}  
			}
		});
	}  
});

function inviteFriends(x){
    $("#eventInviteModal").modal("show");
    $("#eventInviteModalBody").empty();
    var eventid=sessionStorage.event_id;  
    $.ajax({
      type : "get",
      url  : "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/"+eventid,
      success : function(response){
        console.log(response);
        for(var i = 0; i<response.length ; i++){
          var request = response[i];
          var inviteMedia =  document.createElement("div");
          inviteMedia.setAttribute("class","media");
          inviteMedia.setAttribute("id","inviteMedia_"+request["user_id"]);
          
          var mediaLeftDiv = document.createElement("div");
          mediaLeftDiv.setAttribute("class","col-xs-5");

          var divImage = document.createElement("div");
          divImage.setAttribute("class","media-left");
          divImage.setAttribute("id","divImageId_"+request["user_id"]);


          var image = document.createElement("img");
          image.setAttribute("class","media-object");
          image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
          image.style.width = "40px";
          divImage.appendChild(image);
          mediaLeftDiv.appendChild(divImage);

          var divName = document.createElement("div");
          divName.setAttribute("class","media-body");
          divName.setAttribute("id","divNameId_"+request["user_id"]);

          var heading = document.createElement("h4");
          heading.setAttribute("class","media-heading");
          heading.innerHTML=request["first_name"]+" "+request["last_name"];
          divName.appendChild(heading);
          mediaLeftDiv.appendChild(divName);


          var inviteButton = document.createElement("button");
          inviteButton.setAttribute("class","btn btn-default");
          inviteButton.setAttribute("id","button_invite_"+request["user_id"]);
          inviteButton.setAttribute("onClick","sendInvitation(this)");
          inviteButton.innerHTML="Invite";

          var buttonCol = document.createElement("div");
          buttonCol.setAttribute("class","col-xs-3");
          buttonCol.appendChild(inviteButton);
          inviteMedia.appendChild(mediaLeftDiv);
          inviteMedia.appendChild(buttonCol);
          document.getElementById("eventInviteModalBody").appendChild(inviteMedia);

        }
      }
    });
  }

  function sendInvitation(x){
      var id = (x.id).split("_");
      $.ajax({
      	type: "put",
      	url: "http://localhost:8080/facebook_group6/webapi/users/"+id[1]+"/"+id[2]+"/"+sessionStorage.event_id,
      //contentType: "application/json",
      //data: JSON.stringify(jsonObject),
      success: function (response) {
      console.log(response+"profile");
      document.getElementById("inviteMedia_"+id[2]).remove();
            
      }
      });
  }

$("#home").click(function() {
	window.location.href = "http://localhost:8080/facebook_group6/fbHome.html";
});

$("#profile").click(function(){
	window.location.href="http://localhost:8080/facebook_group6/Profile.html";
});

$("#profileFullName").click(function(){
	window.location.href="http://localhost:8080/facebook_group6/Profile.html";
});

$("#logout").click(function() {
	sessionStorage.id = null;
	sessionStorage.fName = null;
	sessionStorage.lName = null;
	sessionStorage.homeTown = null;
	sessionStorage.contact = null;
	sessionStorage.dob = null;
	sessionStorage.book=null;
	window.location.href = "http://localhost:8080/facebook_group6/fblogin.html";
});

function postLikeFunction(x){ 
var id=(x.id).split("_");
if(id[0]=="postLike"){
$.ajax({
	type: "post",
	async:false,
	url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/likes",
	contentType: "application/json",
	success: function (response) {
	document.getElementById("postLike_"+id[1]).innerHTML="UnLike";
	document.getElementById("postLike_"+id[1]).setAttribute("id","postUnlike_"+id[1]);

	//-------------recalculate Like count after 'Like'-----------------------

$.ajax({
	type: "get",
	async:false,
	url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/getLikes",
	contentType: "application/json",
	success: function (response1) {
		var count1=response1.length;
		if(count1==1){ 
			document.getElementById("postLikeCounts_"+id[1]).style.display="block";
			$("#postLikeCounts_"+id[1]).empty();
			var p=document.createElement("p");
         	p.innerHTML="You Like this";
         	document.getElementById("postLikeCounts_"+id[1]).appendChild(p);
		}
		else{
			document.getElementById("postLikeCounts_"+id[1]).style.display="block";
			$("#postLikeCounts_"+id[1]).empty();
			var p=document.createElement("p");
            p.innerHTML="You and ";
            var a=document.createElement("a");
            if(response1.length-1==1)
                 a.innerHTML=(response1.length-1)+" other ";
            else
                 a.innerHTML=(response1.length-1)+" others ";
            a.setAttribute("id","postLikesCountLink_"+id[1]);
            p.appendChild(a);
            // var p1=document.createElement("p");
            // p1.innerHTML="liked this";
            p.appendChild(document.createTextNode("liked this"));
            document.getElementById("postLikeCounts_"+id[1]).appendChild(p); 
		}
	}
});

//-------------recalculate likes count----------------------- 
}
});

}
else{ 
$.ajax({
type: "put",
async:false,
data:id[1],	
url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/likes",
contentType: "application/json",
success: function (response) { 
	document.getElementById("postUnlike_"+id[1]).innerHTML="Like";
	document.getElementById("postUnlike_"+id[1]).setAttribute("id","postLike_"+id[1]);

	//-------------recalculate likes count-----------------------

	$.ajax({
		type: "get",
		async:false,
		url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/getLikes",
		contentType: "application/json",
		success: function (response1) {
			if(response1){
				var count=response1.length; 
				if(count==0){
					document.getElementById("postLikeCounts_"+id[1]).style="none";
					$("#postLikeCounts_"+id[1]).empty();
				}
			else if(count==1){
				document.getElementById("postLikeCounts_"+id[1]).style.display="block";
				$("#postLikeCounts_"+id[1]).empty();
				var a=document.createElement("a");
     			var p=document.createElement("p");
     			p.innerHTML=" liked this";
     			a.setAttribute("id","postLikesCountLink_"+id[1]);
     			a.innerHTML=(response1[0])["first_name"];
    			p.prepend(a);
    			document.getElementById("postLikeCounts_"+id[1]).appendChild(p);
				}
			else{
				document.getElementById("postLikeCounts_"+id[1]).style.display="block";
				$("#postLikeCounts_"+id[1]).empty();
				var p=document.createElement("p");
                p.innerHTML=(response1[0])["first_name"]+" and ";
                var a=document.createElement("a");
                if(response1.length-1==1)
                	a.innerHTML=(response1.length-1)+" other ";
                else
                a.innerHTML=(response1.length-1)+" others ";
                a.setAttribute("id","postLikesCountLink_"+id[1]);
                p.appendChild(a);
                var p1=document.createElement("p");
                 
                p.appendChild(document.createTextNode("liked this"));
                document.getElementById("postLikeCounts_"+id[1]).appendChild(p);
			}
		}
	}
});
//---------------recalculate likes count-----------------------
}
}); 
}
}

function getCommentsLinkFunction(x){    
var id=(x.id).split("_");
if($("#postCommentLink_"+id[1]).text().indexOf("View")!=-1){ 
// $("#commentsOnPost_"+id[1]).show();
document.getElementById("postCommentLink_"+id[1]).innerHTML="Hide Comments";
$.ajax({
	type: "get",
	url: "http://localhost:8080/facebook_group6/webapi/comments/"+id[1],
	contentType: "application/json",
	success: function (response) {

	if(response){   
			$("#commentsOnPost_"+id[1]).empty();
			for(var i=0;i<response.length;i++){
			var comment=response[i];
			var commentMedia=document.createElement("div");
		commentMedia.setAttribute("class", "media");
		commentMedia.setAttribute("id","commentMedia_"+comment["comment_id"]);

		var divImg=document.createElement("div");
		divImg.setAttribute("class","media-left");
		divImg.setAttribute("id","divImageId_"+comment["comment_id"]);
		divImg.style.paddingTop="1px";
	    var image=document.createElement("IMG");
	    image.setAttribute("class","media-object");
	    image.setAttribute("src","users/"+comment["user_id"]+"/"+comment["profilePicUrl"]);
	    image.style.width = "25px";
	    divImg.appendChild(image);

	    var divName=document.createElement("div");
		divName.setAttribute("class", "media-body");
        divName.setAttribute("id","divNameId_"+comment["comment_id"]);
        divName.style.paddingTop="1px";
        var heading=document.createElement("H4");
        heading.setAttribute("class","media-heading");
        heading.innerHTML=comment["userName"];
            
        var commentTime=document.createElement("p");
        commentTime.innerHTML=comment["comment_Date_Time"];
        var commentPara=document.createElement("p");
        commentPara.innerHTML=comment["commentMessage"];
        divName.appendChild(heading);
        divName.appendChild(commentTime);
        divName.appendChild(commentPara);
      	commentMedia.appendChild(divImg);
      	commentMedia.appendChild(divName);
    	document.getElementById("commentsOnPost_"+id[1]).appendChild(commentMedia); 
		}
}
}
});
}
else{
var commentsCount=0;
$("#commentsOnPost_"+id[1]).empty();
$.ajax({
type: "get",
async:false,
url: "http://localhost:8080/facebook_group6/webapi/comments/"+id[1],
contentType: "application/json",
success: function (response) {  
	commentsCount=response.length;
}
});
if(commentsCount==0)
$("#postCommentLink_"+id[1]).hide();

else if(commentsCount==1){ 
$("#postCommentLink_"+id[1]).show();
document.getElementById("postCommentLink_"+id[1]).innerHTML="View "+commentsCount+" Comment";  
}
else{
	$("#postCommentLink_"+id[1]).show();
document.getElementById("postCommentLink_"+id[1]).innerHTML="View "+commentsCount+" Comments";
}
}
}

function postCommentFunction(x){
var id=(x.id).split("_");
if(x.value!="" && event.keyCode==13){
if($("#commentsOnPost_"+id[1]).css('display')=='none'){
	$("#commentsOnPost_"+id[1]).empty();
	$("#commentsOnPost_"+id[1]).show();
}
var comment={"commentMessage":x.value}
$.ajax({
	type: "post",
	contentType:"application/json",
	data:JSON.stringify(comment),
	url: "http://localhost:8080/facebook_group6/webapi/comments/"+sessionStorage.id+"/"+id[1],
	success: function (response) {
		var commentMedia=document.createElement("div");
		commentMedia.setAttribute("class", "media");
		commentMedia.setAttribute("id","commentMedia_"+response["comment_id"]);

		var divImg=document.createElement("div");
		divImg.setAttribute("class","media-left");
		divImg.setAttribute("id","divImageId_"+response["comment_id"]);
		divImg.style.paddingTop="1px";
		var image=document.createElement("IMG");
		image.setAttribute("class","media-object");
		image.setAttribute("src","users/"+response["user_id"]+"/"+response["profilePicUrl"]);
		image.style.width = "25px";
		divImg.appendChild(image);

		var divName=document.createElement("div");
		divName.setAttribute("class", "media-body");
        divName.setAttribute("id","divNameId_"+response["comment_id"]);
        divName.style.paddingTop="1px";
        var heading=document.createElement("H4");
        heading.setAttribute("class","media-heading");
        heading.innerHTML=response["userName"];
            
        var commentTime=document.createElement("p");
        commentTime.innerHTML=response["comment_Date_Time"];
        var commentPara=document.createElement("p");
        commentPara.innerHTML=response["commentMessage"];
        divName.appendChild(heading);
        divName.appendChild(commentTime);
        divName.appendChild(commentPara);
      	commentMedia.appendChild(divImg);
      	commentMedia.appendChild(divName);
    	document.getElementById("commentsOnPost_"+id[1]).appendChild(commentMedia); 
    	document.getElementById("postCommentInput_"+id[1]).value='';
	}
});
}	
}

var form1 = $('#createEvent');
var eventName=document.getElementById("eventName").value;
var eventLoc=document.getElementById("eventLoc").value;
var eventStart=document.getElementById("eventStart").value;
var eventEnd=document.getElementById("eventEnd").value;
	form1.submit(function () {
		if(eventName!="" && eventLoc!="" && eventStart!="" && eventEnd!=""){
			$.ajax({
				type: form1.attr('method'),
				url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/events",
				data: form1.serialize(),
				success: function (response) {			
			    	console.log(response);
			    	if(response!=null){
			    		sessionStorage.event_id=response.event_id;
			    		sessionStorage.event_name=response.event_name;
			    		sessionStorage.hosted_by=response.hosted_by;
			    		sessionStorage.start_date=response.start_date;
			    		sessionStorage.end_date=response.end_date;
			    		sessionStorage.location=response.location;
			    		sessionStorage.description=response.description;
			    		sessionStorage.status=response.status;
			    		window.location.href = "http://localhost:8080/facebook_group6/event_page.html";
			    	}
			    	else
			    		alert("Error redirectin to event page!!!");
			    }
			});
		}
		else{
			if(eventName.isEmpty())
				alert("Event Name is required!");
			else if(eventLoc.isEmpty())
				alert("Event Location is required!");
			else if(eventStart.isEmpty())
				alert("Starting date  is required!");
			else
				alert("End date is required!");
		}
	return false;
	});	
	
	function countGoingAndInterested(){
		$.ajax({
			type: "get",
			url: "http://localhost:8080/facebook_group6/webapi/events/getCount/"+sessionStorage.event_id,
			contentType: "application/json",
			success: function (response) {
				console.log("*************************************** : "+response[0]);
				if(response!=null){
					document.getElementById("goingCount").innerHTML =response.split("_")[0]+" going";
					document.getElementById("intrestedCount").innerHTML = response.split("_")[1]+" interested";
				}
				else
					alert("null response in getting count!")
			}
		});
	}
	
	function popoverFunc(){   
	    $("#chat").empty();            
	        $.ajax({
	        	type  : "get",
	            url   : "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/friends",
	            success: function(response){     
	              if(response!=null){
	            	console.log(response);
	                for(var i=0;i<response.length;i++)
	                {
	                  var request = response[i];
	                  var div = document.createElement("div");
	                  div.setAttribute("id",request["user_id"]);
	                  
	                  var name = request["first_name"]+" "+request["last_name"];
	                  var dob = request["date_of_birth"];
	                  var hometown = request["home_town"];
	                  var test = request["test"];
	                  
	                  var title="<div class=\"media\">"+"<div class=\"media-left\">"+
	                      	"<img src=\"users/"+request["user_id"]+"/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:100px;height:100px\">"+
	                    	"</div>"+
	                   	 	"<div class=\"media-body\" style=\"padding-top:10px\"><h4 class=\"media-heading\"><a href=\"#\">"+name+"</a></h4>"+
	                      	"<p>"+dob+"<br>"+hometown+"<br>"+test+"</p></div></div>";

	                  var anc = document.createElement("a");
	                  anc.setAttribute("id","anc_"+request["user_id"]);
	                  anc.setAttribute("href","#");
	                  anc.setAttribute("data-toggle","popover");
	                  anc.setAttribute("data-trigger", "hover");
	                  anc.setAttribute("data-content", title);
	                  anc.setAttribute("data-placement","left");
	                  anc.setAttribute("data-html","true");
	                 
	                  var img = document.createElement("img");
	                  img.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
	                  img.style.width = "25px";

	                  anc.appendChild(img);
	                 
	                  var name = document.createTextNode(request["first_name"]+" "+request["last_name"]);
	                  anc.appendChild(name);
	                  div.appendChild(anc);
	                  document.getElementById("chat").appendChild(div);

	                  var hr = document.createElement("hr");
	                  document.getElementById("chat").appendChild(hr);
	                  $('[data-toggle="popover"]').popover();
	                }
	              }
	            }
	          });
	    }
	
	function search()
	{	
		console.log(document.getElementById("navBarSearch"));
		if(event.keyCode==13 && document.getElementById("navBarSearch").value!=''){
		$.ajax({
			type: "get",
			url: "http://localhost:8080/facebook_group6/webapi/users/search?searchData="+document.getElementById("navBarSearch").value+"&from=home"+"&userId="+sessionStorage.id,
				success: function (response) {
				console.log(response+"profile");
				window.location.href = "http://localhost:8080/facebook_group6/search.html";		
			}
			});
		}
	}

</script>
</html>    