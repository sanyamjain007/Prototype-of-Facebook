<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

   
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

   
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->
    <link rel="stylesheet" type="text/css" href="dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css"
	href="dist/css/bootstrap-theme.min.css">
<script src="dist/js/jquery-3.1.1.js"></script>
<script src="dist/js/bootstrap.js"></script>
<script src="dist/font/"></script>
    <link rel="stylesheet" type="text/css" href="fbhome.css">
    
    <style>
     @media only screen and (max-width : 540px) 
            {
                
                
            }
    .popup-box
            {
                z-index:100000000;
                position: fixed;
                bottom: 0px;
                right: 220px;
                height: 285px;
                background-color: rgb(237, 239, 244);
                width: 300px;
                border: 1px solid rgba(29, 49, 91, .3);
            }
            
            .popup-box .popup-head
            {
                background-color: #6d84b4;
                padding: 5px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                clear: both;
            }
            
            .popup-box .popup-head .popup-head-left
            {
                float: left;
            }
            
            .popup-box .popup-head .popup-head-right
            {
                float: right;
                opacity: 0.5;
            }
            
            .popup-box .popup-head .popup-head-right a
            {
                text-decoration: none;
                color: inherit;
            }
            
            .popup-box .popup-messages
            {
                height: 225px;
                overflow-y: scroll;
            }
            
    .test1 {
width: 70%;
word-wrap: break-word;
padding: 0.5em;
margin-left:0.5em;
}

.test2 {
width: 70%;
word-wrap: break-word;
padding: 0.5em;
}
   
    </style>
    
</head>
<body>
<nav class="navbar navbar-fixed-top"  style="z-index:1000000">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">
        <img src="fblogo.jpg" width="20px">
      </a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <input id="navBarSearch" type="text" value="" name="navBarSearch" placeholder="Search People" size="40px" onkeydown="search()" style="margin-top:12px">
      <div class="nav navbar-nav navbar-right">
  <div class="btn-toolbar pull-right" role="toolbar">
  <div class="btn-group" role="group">
<img id="navPic" src="pic.jpg" width="40px" height="40px"
style="padding: 0px">
<button id="profile" class="navbar-btn" type="button">Priyank</button>
<button id="home" class="navbar-btn" type="button">Home</button>
<button class="navbar-btn" type="button">
<span class="glyphicon glyphicon-user"></span>
</button>
<button class="fb-notifications navbar-btn" type="button">
<span class="glyphicon glyphicon-comment"></span>
</button>
<button class="fb-notifications navbar-btn" type="button">
<span class="glyphicon glyphicon-globe"></span>
</button>
</div>
    <div class="btn-group" role="group">
      <div class="dropdown btn-group" role="group">
        <button id="dropbtn1" type="button" class="btn btn-default dropdown-toggle navbar-btn" data-toggle="dropdown" aria-haspopup="true">
        <span class="glyphicon glyphicon-triangle-bottom"></span>
        </button>
       <ul class="dropdown-menu" aria-labelledby="dropbtn1">
       
         <li><a id="logout" href="#">Log out</a></li>
       </ul>
      </div>
    </div>
  </div>
 </div>
    </div>
  </div><!-- /.container -->
</nav>

<div class="container-fluid" style="margin-top:60px">
  <div class="row">
    <div class="col-xs-2">
      <ul class="nav nav-pills nav-stacked">
        <li role="presentation"><a href="http://localhost:8080/facebook_group6/Profile.html"><img id="homeProfileImg2" src="pic.jpg" width="35px">
        <span id="name" style="margin-left:10px;font-size:15px"></span></a></li>
        <li role="presentation">FAVORITES</li>
        <!-- The class "active" highlights this item in the list -->
        <li role="presentation">
          <a href="http://localhost:8080/facebook_group6/fbHome.html"><span class="glyphicon glyphicon-list-alt"></span> News Feed</a>
        </li>
        <li role="presentation">EXPLORE </li>

        <li role="presentation">
          <a href="http://localhost:8080/facebook_group6/events.html"><span class="glyphicon glyphicon-calendar"></span>Events</a>
        </li>
        <li role="presentation">
          <a href="http://localhost:8080/facebook_group6/groups.html"><span class="glyphicon glyphicon-user"></span> Groups</a>
        </li>
        <li role="presentation">
          <a href="http://localhost:8080/facebook_group6/find_friend.html" style="margin-top:-10px"><span class="glyphicon glyphicon-user"></span> Find Friends</a>
        </li>
      </ul>
  </div>
  <div class="col-xs-8">
    <div class="header" style="height:200px">
      <div class="Image">
        <img src="group_image.jpg" width="100%" height="150px">
        <div class="withinImage" style="position:absolute;top:0">
          <span id="groupname" style="font-size:25px; color:white; float:left; margin-top:90px; margin-left:20px">groupname</span>
          <span id="ownername" style="font-size:20px; color:white; float:left; margin-top:120px; margin-left:40px">create by admin</span>
          
          <span style="margin-top:100px; margin-left:200px"></span>
          <button id="join" type="button" class="btn btn-secondary btn-sm" style="margin-top:100px; ">Join</button> 
          <button id="pending" type="button" class="btn btn-secondary btn-sm" style=" margin-top:100px; ">Pending</button> 
           <button id="joined" type="button" class="btn btn-secondary btn-sm" style=" margin-top:100px; "><span class="glyphicon glyphicon-ok">Joined</span></button>
           <button id="leave" type="button" class="btn btn-secondary btn-sm" style=" margin-top:100px;">Leave</button>
        </div>
      </div>
      <div class="lowerButtons" style="background:white">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-secondary" style="background:#ffffff"><b>Discussions</b></button>
            <button id="members" type="button" class="btn btn-secondary" style="background:#ffffff"><b>Members</b></button>
           
            
        </div> 
      </div>
    </div>
 
<div class="panel panel-default" style="max-height: 200px;overflow-y:scroll" style="z-index:0">
          <div class="panel-body">
            <h4><b id="memberCount"></b></h4>
              <div id="groupmembersrows" class="row">
              </div>
          </div>
    </div>
 
    <div class="row"  style="z-index:-1">
      <div   class="col-xs-7" style="padding-right:20px">
        <div class="group panel panel-default" style="margin-top:20px">
          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link" href="#"><span class="glyphicon glyphicon-pencil"></span> Write post</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#"><span class="glyphicon glyphicon-film"></span> Add Video/Photos</a>
            </li>
          </ul>
          <div class="panel-body">  
            
            <form  method="post"  id="form1" enctype="multipart/form-data">
<div class="row">
 <a href="#"><span class="glyphicon glyphicon-camera"></span><label  for="files"> Upload Photo</label></a>
<input type="file" name="file" id="file_data"/>
<!-- <p id="uploadImage">Select a file : <input type="file" name="file" size="45" id="file_data" class="btn btn-success" /></p> -->
  <input type="text" name= "user_name" id="user_name" style="display:none" />
  <div class="col-md-2"><img id="homeProfileImg" src="pic.jpg" class="img-circle" width="100%"/></div>  
  
  <div class="col-md-10"><textarea name="postdata" class="form-control" id="feedbox" rows="3"></textarea><br>
  <button type="submit" class="btn btn-primary" >Post</button>
  </div>
</div>
</form>    

          </div>    <!-- panel body ends -->
        </div>    <!-- group panel ends -->
        
        <div id="postCol">
        
        <!--   -------------------------------------Group posts---------------------------------  -->
        
        </div>
      </div>      <!-- inner column ends -->
      <div class="col-xs-5">
        <div class="group panel panel-default" style="margin-top:20px">
          <div class="panel-body">   
            <span >ADD MEMBERS</span>
            <div class="search_member" style="margin-left:-20px">
             
                <div class="input-group"> 
                  <input type="text" id="member_search" class="form-control" placeholder="enter name or email" name="srch-term" >
                    <div class="input-group-btn">
                      <button id="search_btn" class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
               </div>
           
            </div><hr>
            <div id="memberresult" class="row" style="max-height:150px;overflow-y:scroll">
            </div>
            <div class="joinrequest">
              <span style="color:#888888">GROUP JOIN REQUESTS</span> 
             
            </div> 
            <div id="requestingmember" class="row" style="max-height:150px;overflow-y:scroll">
            </div>       
          </div> <!-- panel body ends-->
        </div>
      </div>
    </div>    <!-- inner row ends -->
  </div>    <!-- ouer column ends -->

  
  <div class="col-xs-2" class="panel" style="padding-right:0px;" >
     <!-- Chat room -->
      <div class="panel-header"><input type="text" style="width:100%" placeholder="filter"></div>
          <div class="panel-body" style="padding-right:0px;">
            <div class="h-scroll" id="chat" style="background-color:white;padding-left:10px;">
              
          </div>
          
        </div>
   </div>
</div>
</div>
  </body>
  <script >
  
  $("#members")
  .click(function(){
 $("#groupmembersrows").empty();
 $.ajax({
type: "get",
url: "http://localhost:8080/facebook_group6/webapi/groups/"+sessionStorage.groupid+"/members",
contentType: "application/json",
success: function (response) {
//alert("success");
console.log(response);
 
if(response!=null)
{ requestCount=response.length;
document.getElementById("memberCount").innerHTML=" Total "+requestCount+" members";
for(var i=0;i<response.length;i++)
{ 
var request=response[i];
 
var requestMedia=document.createElement("div");
requestMedia.setAttribute("class", "media");
requestMedia.setAttribute("id","requestMedia_"+request["user_id"]);
var requestCol=document.createElement("div");
requestCol.setAttribute("class","col-xs-8");
 
 
var divImg=document.createElement("div");
divImg.setAttribute("class","media-left");
divImg.setAttribute("id","divImageId_"+request["user_id"]);
    var image=document.createElement("IMG");
    image.setAttribute("class","media-object");
    image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
    image.style.width = "40px";
    divImg.appendChild(image);
 
var divName=document.createElement("div");
    divName.setAttribute("class", "media-body");
                divName.setAttribute("id","divNameId_"+request["user_id"]);
                divName.style.paddingTop="10px";
                var heading=document.createElement("a");
                    heading.setAttribute("class","media-heading");
                    heading.setAttribute("id",request["user_id"]);
                    //heading.setAttribute("onClick","linktoprofilefunction(this);");
                    heading.innerHTML=request["first_name"]+" "+request["last_name"];
                var para=document.createElement("p");
                    para.innerHTML=request["date_of_birth"];
                divName.appendChild(heading);
                divName.appendChild(para);
              requestCol.appendChild(divImg);
              requestCol.appendChild(divName);
              
              var buttonCol= document.createElement("div");
              buttonCol.setAttribute("class","col-xs-4");
               var  buttonToolbar=document.createElement("div");
                    buttonToolbar.setAttribute("class", "btn-toolbar");
                    buttonToolbar.setAttribute("role", "toolbar");
                    buttonToolbar.setAttribute("id", "buttonToolbarId_"+request["user_id"]);
                    buttonToolbar.setAttribute("aria-label","...");
                    buttonToolbar.style.paddingTop="15px";
                    
               var  buttonGroup =document.createElement("div");
                    buttonGroup.setAttribute("class","btn-group");
                    buttonGroup.setAttribute("role","group");
                    buttonGroup.setAttribute("aria-label","...");
                     var joinButton=document.createElement("BUTTON");
                       joinButton.setAttribute("onClick","memberRemovefunction(this)");
                       joinButton.setAttribute("id","button_removegroup_"+request["user_id"]);
                       joinButton.setAttribute("class","btn btn-success");
                       joinButton.innerHTML="Remove member";
   					buttonGroup.appendChild(joinButton);
                   
   			buttonToolbar.appendChild(buttonGroup);
   			buttonCol.appendChild(buttonToolbar);
   			requestMedia.appendChild(requestCol);
   			requestMedia.appendChild(buttonCol);
         
			//requestMedia.appendChild(requestCol);
 
 
document.getElementById("groupmembersrows").appendChild(requestMedia);
                
}
}
 
}
 })
  })
  
   $("#join")
  .click(function(){
 $.ajax({
	 type: "put",
		url: "http://localhost:8080/facebook_group6/webapi/groups/"+sessionStorage.groupid+"/members/"+sessionStorage.id+"/joinGroupRequest",

		contentType: "application/json",
		
		success: function (response) {
			console.log(response);
			if(response!=null)
				{
				//window.location.href = "http://localhost:8080/facebook_group6/group_page.html";
				$("#join").hide();
				$("#pending").hide();
				//$("").show();
				}
			}
 })
  })
  
  $("#leave")
  .click(function(){
 $.ajax({
type: "put",
url: "http://localhost:8080/facebook_group6/webapi/groups/"+sessionStorage.groupid+"/members/"+sessionStorage.id+"/leaveGroup",
contentType: "application/json",
success: function (response) {
//alert("success");
console.log(response);
 if(response!=null)
	 {
	// window.location.href = "http://localhost:8080/facebook_group6/group_page.html";
	 $("#leave").hide();
	 $("#joined").hide();
	 $("#join").show();
	 }
 
}
 })
  })
  
   function memberRemovefunction(x)
	  {
	  var id=(x.id).split('_');

	  //console.log("buttonId"+id[2]);

	  	$.ajax({
	  			type: "put",
	  			url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/groups/"+sessionStorage.groupid+"/members/"+id[2]+"/removemember",

	  			contentType: "application/json",
	  			
	  			success: function (response) {
	  				console.log(response);
	  				if(response!=null)
	  					{
	  					window.location.href = "http://localhost:8080/facebook_group6/group_page.html";
	  					}
	  				else
	  					alert("only admin can remove the group members");
	  				}
	  	});
	}
  
  $("#search_btn")
  .click(
  function() {
 
  if(document.getElementById("member_search").value!='')
  {
	 	$("#memberresult").empty();
// alert("inside");
  $.ajax({
  type: "get",
  url: "http://localhost:8080/facebook_group6/webapi/users/search?searchData="+document.getElementById("member_search").value+"&from=search&userId="+sessionStorage.id,
  success: function (response) 
  {
  // alert("insideiiiiiiiiiiiiiiii");
  console.log(response);
  if (response != null) {
// alert(response.length);
var i;
for (i = 0; i < response.length ; i++) 
{   
var request=response[i];
           var requestrow=document.createElement("div");
           requestrow.setAttribute("class", "row");
           requestrow.style.pddingleft="10px";
var requestMedia=document.createElement("div");
requestMedia.setAttribute("class", "media");
requestMedia.setAttribute("id","requestMedia_"+request["user_id"]);
var requestCol=document.createElement("div");
requestCol.setAttribute("class","col-xs-8");
 
 
var divImg=document.createElement("div");
divImg.setAttribute("class","media-left");
divImg.setAttribute("id","divImageId_"+request["user_id"]);
    var image=document.createElement("IMG");
    image.setAttribute("class","media-object");
    image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
    image.style.width = "25px";
    divImg.appendChild(image);
 
var divName=document.createElement("div");
    divName.setAttribute("class", "media-body");
             //   divName.setAttribute("id","divNameId_"+request["user_id"]);
                divName.style.paddingTop="10px";
                var link=document.createElement("a");
                // link.setAttribute("href","group_page.html");
                    link.setAttribute("class","media-heading");
                    //link.setAttribute("onClick","linktoprofilefunction(this);");
                link.setAttribute("id","linktoprofile_"+request["user_id"]);
                    link.innerHTML="<h5>"+request["first_name"]+" "+request["last_name"]+"</h5>";
                
                    var buttonCol= document.createElement("div");
                    buttonCol.setAttribute("class","col-xs-1");
                    
                          
                     
                           var addButton=document.createElement("BUTTON");
                             addButton.setAttribute("onClick","addmemberfunction(this)");
                             addButton.setAttribute("id","addMembersearch_"+request["user_id"]);
                             addButton.setAttribute("class","btn btn-success pull-right");
                             addButton.innerHTML="Add";
          buttonCol.appendChild(addButton);
                    
                divName.appendChild(link);
              requestCol.appendChild(divImg);
              requestCol.appendChild(divName);
             
              requestrow.appendChild(requestCol);
              requestrow.appendChild(buttonCol);
              requestMedia.appendChild(requestrow);
              
              document.getElementById("memberresult").appendChild(requestMedia);
  }
  }
  }
  });
 
  }
  });
  
  function addmemberfunction(x)
  { 
  var userid= (x.id).split("_")[1];
 // alert(x.id);
 // console.log(response);
  var jsonObject={"user_id":userid};
  $.ajax({
 
  type: "put",
  url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/groups/"+sessionStorage.groupid+"/members",
  contentType: "application/json",
  data:JSON.stringify(jsonObject),
  success: function (response) {
 
  console.log(response);
  if(response!=null)
    {
  // alert("member added successfully");
    sessionStorage.userid=response.user_id;
    //sessionStorage.username="response.first_name"+"response.last_name";
    //sessionStorage.userid=response.created_by;
    window.location.href = "http://localhost:8080/facebook_group6/group_page.html";
    }
  else
	  {
	  	alert("already added or already invited");
	  }
  }
  });
  }
  
  function linktoprofilefunction(x)
  { 
  var userid= (x.id).split('_');
//  alert(x.id);
  //console.log(response);
  $.ajax({
   
  type: "get",
  url: "http://localhost:8080/facebook_group6/webapi/users/"+userid,
  contentType: "application/json",
  success: function (response) {
 
  console.log(response);
  if(response!=null)
    {
    sessionStorage.userid=response.user_id;
    sessionStorage.username="response.first_name"+"response.last_name";
    //sessionStorage.userid=response.created_by;
    window.location.href = "http://localhost:8080/facebook_group6/Profile.html";
    }
  }
  });
  }
  
  function popoverFunc() {
      $("#chat").empty();
     
      $
          .ajax({
              type: "get",
              url: "http://localhost:8080/facebook_group6/webapi/users/" + sessionStorage.id + "/friends",
              success: function(response) {
                  if (response != null) {
                      console.log(response);
                      for (var i = 0; i < response.length; i++) {
                          var request = response[i];
                          var div = document.createElement("div");
                          div.setAttribute("id", "div_"+request["user_id"]);

                          var name = request["first_name"] + " " + request["last_name"];
                          var dob = request["date_of_birth"];
                          var hometown = request["home_town"];

                          var title = "<div class=\"media\">" + "<div class=\"media-left\">" + "<img src=\"users/" + request["user_id"] + "/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:100px;height:100px\">" + "</div>" + "<div class=\"media-body\" style=\"padding-top:10px\"><h4 class=\"media-heading\"><a href=\"#\">" + name + "</a></h4>" + "<p>" + dob + "<br>" + hometown + "</p></div></div>";
                        

                          var anc = document.createElement("a");
                          anc.setAttribute("id", "anc_frnd_" + request["user_id"]);
                         

                          var img = document.createElement("img");
                          img.setAttribute("src", "users/" + request["user_id"] + "/"+request["profilePicUrl"]);
                          img.setAttribute("id","frnd_pop_"+request["user_id"]+"_"+request["first_name"]);
                          img.style.width = "25px";
                          img.setAttribute("onClick","register_popup(this)");
                         

                          anc.appendChild(img);
                          var id=request["first_name"];
                          var name = document.createElement("a");
                          name.setAttribute("id","frnd_pop_"+request["user_id"]);
                          name.innerHTML=request["first_name"]+" "+request["last_name"]; 
                          //name.setAttribute("href","javascript:register_popup(request.first_name,request.first_name);");
                           name.setAttribute("class","hover");
                           name.setAttribute("data-toggle", "popover");
                           name.setAttribute("data-trigger", "hover");
                           name.setAttribute("onmouseenter","postNamepop(this)");
                         
                         
                          anc.appendChild(name);
                          div.appendChild(anc);
                          document.getElementById("chat")
                              .appendChild(div);

                          var hr = document.createElement("hr");
                          document.getElementById("chat").appendChild(hr);
                        
                      }
                  }
              }
          });
  }
  
Array.remove = function(array, from, to) {
 var rest = array.slice((to || from) + 1 || array.length);
 array.length = from < 0 ? array.length + from : from;
 return array.push.apply(array, rest);
}

//this variable represents the total number of popups can be displayed according to the viewport width
var total_popups = 0;

//arrays of popups ids
var popups = [];

//this is used to close a popup
function close_popup(id)
{
console.log("in close "+ id);
 for(var iii = 0; iii < popups.length; iii++)
 {
     if(id == popups[iii])
     {
      console.log(popups[iii],id);
      
         Array.remove(popups, iii);
         console.log(popups[iii],id);
         
         document.getElementById(id).style.display = "none";
         document.getElementById(id).remove();
         console.log(document.getElementById(id));
         calculate_popups();
         console.log("close end");
         for(var i=0; i<popups.length;i++)
          {
          console.log(popups[i]);
          }
         console.log("close popup");
         return;
     }
 }   
}

//displays the popups. Displays based on the maximum number of popups that can be displayed on the current viewport width
function display_popups()
{
console.log("in display popup");
 var right = 220;
 
 var iii = 0;
 for(iii; iii < total_popups; iii++)
 {
  
     if(popups[iii] != undefined)
     {
      console.log("in popup fn if statament"+ popups[iii]);
         var element = document.getElementById(popups[iii]);
         element.style.right = right + "px";
         right = right + 320;
         element.style.display = "block";
        // console.log(element);
     }
 }
 
 for(var jjj = iii; jjj < popups.length; jjj++)
 {
     var element = document.getElementById(popups[jjj]);
     element.style.display = "none";
 }
 console.log("end of display popup");
}


//creates markup for a new popup. Adds the id to popups array.
function register_popup(x)

{
console.log("in rgister function");
var popid= x.id;
console.log(popid);
var temp =x.id.split('_')[2];
var id=temp;
var name = x.id.split('_')[3];
console.log(name);
console.log("id in register "+id);
 
 console.log(popups.length);
 //System.out.println("in register function")
 for(var iii = 0; iii < popups.length; iii++)
 {   
     //already registered. Bring it to front.
     if(id == popups[iii])
     {
      console.log("in if");
         Array.remove(popups, iii);
      console.log(popups.length);
         popups.unshift(id);
         
         calculate_popups();
         
         
         return;
     }
 }               
 
 var element = '<div class="popup-box chat-popup" id="'+ id +'">';
 element = element + '<div class="popup-head">';
 element = element + '<div class="popup-head-left">'+ name +'</div>';
 element = element + '<div class="popup-head-right"><a href="javascript:close_popup(\''+ id +'\');">&#10005;</a></div>';
 element = element + '<div style="clear: both"></div></div><div  id="popup_messages_'+id+'" class="popup-messages"></div>';
 element = element +'<div><input id="chatText_'+id+'"  type="text" onkeyDown="setMessage(this)" style="width:100%;margin-bottom:50px"/></div></div>';
 //console.log("in register"+element);
 //var pop =document.getElementById("pop_upbox");
 //pop.append(element);
 //console.log(pop);
 console.log(element);
// document.getElementsByTagName("body")[0].innerHTML = document.getElementsByTagName("body")[0].innerHTML + element;
$("body").append(element);
//console.log(document.getElementsByTagName("body")[0].innerHTML);
 popups.unshift(id);
 console.log("popups"+popups.length);
         
 calculate_popups();
 console.log("end of from regster");
 
// document.getElementById("popup_messages_"+id).appendChild(document.createTextNode("hello"));


 $.ajax({
type : "get",
url : "http://localhost:8080/facebook_group6/webapi/userMessages/getTextMessages/"+sessionStorage.id+"/"+id,
success : function(data) {

if(data)
{
var len=data.length;
for(var i=0;i<len;i++)
{
var message=data[i];
if(message.sender_id==sessionStorage.id)
createDiv(message.message,"alert alert-success  test1 pull-left","popup_messages_"+id,id);
else
createDiv(message.message,"alert alert-success test1 pull-right","popup_messages_"+id,id);
}
}
//createDiv($('#chatText_'+id).val(),"alert alert-success test1 pull-left","popup_messages_"+id,id);

}
});



}
function setMessage(x)
{
var id1 = (x.id).split("_");
if (x.value != "" && event.keyCode == 13)
{
var obj={"sender_id":sessionStorage.id,"receiver_id":id1[1],"message":document.getElementById(x.id).value}
$.ajax({
type : 'PUT',
data : JSON.stringify(obj),
contentType:"application/json",
url : "http://localhost:8080/facebook_group6/webapi/userMessages/sendTextMessages",
success : function(data) {

if(data)
{
createDiv(data.message,"alert alert-success test1 pull-left","popup_messages_"+id1[1],id1[1]);
document.getElementById(x.id).value='';
}
//createDiv($('#chatText_'+id).val(),"alert alert-success test1 pull-left","popup_messages_"+id,id);

}
});
}
}

function createDiv(message,cl,id1,id2){
var Div_1 = document.createElement('div');
Div_1.className = cl;
var para=document.createElement('p');
var node = document.createTextNode(message);
para.appendChild(node);
Div_1.appendChild(para);
var element = document.getElementById(id1);
element.appendChild(Div_1);
var objDiv = document.getElementById(id1);
objDiv.scrollTop = objDiv.scrollHeight;
}




//calculate the total number of popups suitable and then populate the toatal_popups variable.
function calculate_popups()
{
 var width = window.innerWidth;
 if(width < 540)
 {
     total_popups = 0;
 }
 else
 {
     width = width - 200;
     //320 is width of a single popup box
     total_popups = parseInt(width/320);
 }
 console.log("hello"+total_popups);
 display_popups();
 
}

//recalculate when window is loaded and also when window is resized.
window.addEventListener("resize", calculate_popups);
window.addEventListener("load", calculate_popups);

/*--------------------------------------pop over function-------------------------------------------------  */
function fun() {

var element = $(this);
var id = element.attr("id");
//alert(id);
$(".hover").popover({
content : fetchdata1,
html : true,
placement:"top"
});
}

function fetchdata1() {

var friendList = "<p>";
var element = $(this);
var pid = element.attr("id");
var ido = pid.split('_');
console.log(ido);
$.ajax({
url : "http://localhost:8080/facebook_group6/webapi/users/"
+ ido[2],
method : "GET",
async : false,
//contentType: 'application/json',

success : function(request) {
console.log(request);
var name = request["first_name"] + " "
+ request["last_name"];
var dob = request["date_of_birth"];
var hometown = request["home_town"];


friendList = friendList + "<div class=\"media\">"
+ "<div class=\"media-left\">"
+ "<img src=\"users/"+request["user_id"]+"/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:100px;height:100px\">"
+ "</div>"
+ "<div class=\"media-body\" style=\"padding-top:10px\"><h4 class=\"media-heading\"><a href=\"#\">"
+ name + "</a></h4>" + "<p>" + dob
+ "<br>" + hometown
+ "</p></div></div>";
}
//return fetch_data;
});
console.log(friendList);
return friendList;
}


/*--------------------------------------pop over function-------------------------------------------------  */
/*--------------------------------------chat box-------------------------------------------------  */
function postNamepop(x){

var element=$(x);
var id=element.attr("id");
console.log(id);
$(".hover").popover({
content:fetchNameim,
html:true,
placement:'left'
});
}


function fetchNameim(){
console.log("hello");
var friendList="<p>";
var element=$(this);
var pid=element.attr("id");
var ido = pid.split('_');
//console.log(ido[2]);;
$.ajax({
url:"http://localhost:8080/facebook_group6/webapi/users/"+ido[2],
method:"GET",
async:false,
//contentType: 'application/json',
     
     success: function(request){
      var name = request["first_name"]+" "+request["last_name"];
               var dob = request["date_of_birth"];
               var hometown = request["home_town"];
      friendList=friendList+"<div class=\"media\">"+"<div class=\"media-left\">"+
                   "<img src=\"users/"+request["user_id"]+"/"+request["profilePicUrl"]+"\" class=\"media-object\" style=\"width:100px;height:100px\">"+
                 "</div>"+
                 "<div class=\"media-body\" style=\"padding-top:10px\"><h4 class=\"media-heading\"><a href=\"#\">"+name+"</a></h4>"+
                   "<p>"+dob+"<br>"+hometown+"</p></div></div>";
    //friendList = friendList+"First Name :"+data.first_name+"<br>"+"Last Name :"+data.last_name+"<br>"+"City :"+data.home_town+"<br>"+"Date Of birth:"+data.date_of_birth;

     }

});
console.log(friendList);
return friendList;
}


  
  
  $("#home")
.click(
function() {

window.location.href = "http://localhost:8080/facebook_group6/fbHome.html";
});
  $("#profile").click(function(){
window.location.href="http://localhost:8080/facebook_group6/Profile.html";
 
});

$("#logout").click(function(){
 
	sessionStorage.id = null;
	sessionStorage.fName = null;
	sessionStorage.lName = null;
	sessionStorage.homeTown = null;
	sessionStorage.contact = null;
	sessionStorage.dob = null;
	sessionStorage.book=null;
  window.location.href = "http://localhost:8080/facebook_group6/fblogin.html";
});

 
var form = $('#form1');
form.submit(function () {

var fd = new FormData($('#form1')[0]);
console.info(fd);
$.ajax({
type: form.attr('method'),
url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/groups/"+sessionStorage.groupid+"/posts",
data : fd,
enctype : 'multipart/form-data',
processData : false, // Important!
contentType : false,
cache : false,
success: function (data) {
 
 
	setTimeout(function(){window.location.reload();},5000);
 
} 
});
return false; 
});


 
function requestApprovefunction(x)
{
var id=(x.id).split('_');

//console.log("buttonId"+id[2]);

	$.ajax({
			type: "put",
			url: "http://localhost:8080/facebook_group6/webapi/groups/"+sessionStorage.groupid+"/members/"+id[2]+"/joinGroup",

			contentType: "application/json",
			
			success: function (response) {
				console.log(response);
				if(response!=null)
					{
					window.location.href = "http://localhost:8080/facebook_group6/group_page.html";
					}
				}
	});
}

function declineRequestfunction(x)
{
var id=(x.id).split('_');

//console.log("buttonId"+id[2]);

	$.ajax({
			type: "put",
			url: "http://localhost:8080/facebook_group6/webapi/groups/"+sessionStorage.groupid+"/members/"+id[2]+"/declineGroup",

			contentType: "application/json",
			
			success: function (response) {
				console.log(response);
				if(response!=null)
					{
					window.location.href = "http://localhost:8080/facebook_group6/group_page.html";
					}
				}
	});
}
 
  
  $(document).ready(function(){
   
   if(sessionStorage.id=="null")
      window.location.href = "http://localhost:8080/facebook_group6/fblogin.html";
   
   else
   {document.getElementById("groupname").innerHTML="<h2>"+sessionStorage.groupname+"</h2>";
   document.getElementById("homeProfileImg").src="users/"+sessionStorage.id+"/"+sessionStorage.profilePicUrl;
    document.getElementById("navPic").src="users/"+sessionStorage.id+"/"+sessionStorage.profilePicUrl;
    document.getElementById("homeProfileImg2").src="users/"+sessionStorage.id+"/"+sessionStorage.profilePicUrl;
    document.getElementById("navBarSearch").value='';
    document.getElementById("name").innerHTML=sessionStorage.fName+" " + sessionStorage.lName;
    document.getElementById("profile").innerHTML="<h5>"+sessionStorage.fName+"</h5>";
    
    popoverFunc();      
      $.ajax({
			  		 
		  			type: "get",
		  			url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/groups/"+sessionStorage.groupid+"/ownername",
		  			
		  			success: function (response) {
		  				var name=response;
		  				console.log(response);
		  				if(name!=null)
			    		{
			    			
			    			sessionStorage.ownername=response;
			    			document.getElementById("ownername").innerHTML="created by: "+sessionStorage.ownername;
			    			//alert(sessionStorage.ownername);
			    		//window.location.href = "http://localhost:8080/facebook_group6/group_page.html";
			    		}
		  				
		  	}
		  	});
     
     $.ajax({
  type: "get",
  url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/groups/"+sessionStorage.groupid+"/userstatus",
  success: function (response) 
  {
	  var st;
	  st=response;
	 // alert("status : "+st);
  console.log(response);

   if(response==1)
	  {
	  $("#join").hide();
	  $("#pending").hide();
	  }
  else if(response == 2 || response== 3)
	  {
	  $("#leave").hide();
	  $("#joined").hide();
	  $("#join").hide();
	  }
  else
	  {
	  $("#leave").hide();
	  $("#joined").hide();
	  $("#pending").hide();
	  }
  //alert("alerttttt");
  }
     });
     
     //------------get group join requests made by users
     
     $.ajax({
  type: "get",
  url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/groups/"+sessionStorage.groupid+"/joinrequests",
  success: function (response) 
  {
  // alert("insideiiiiiiiiiiiiiiii");
  console.log(response);
  if (response != null) {
// alert(response.length);
var i;
for (i = 0; i < response.length ; i++) 
{   
var request=response[i];
var requestMedia=document.createElement("div");
requestMedia.setAttribute("class", "media");
requestMedia.style.pddingleft="10px";
requestMedia.setAttribute("id","requestMedia_"+request["user_id"]);
var requestCol=document.createElement("div");
requestCol.setAttribute("class","col-xs-8");



 var divImg=document.createElement("div");
	 divImg.setAttribute("class","media-left");
	 divImg.setAttribute("id","divImageId_"+request["user_id"]);
     var image=document.createElement("IMG");
	     image.setAttribute("class","media-object");
	     image.setAttribute("src","users/"+request["user_id"]+"/"+request["profilePicUrl"]);
	     image.style.width = "25px";
     divImg.appendChild(image);
 
 var divName=document.createElement("div");
     divName.setAttribute("class", "media-body");
  //   divName.setAttribute("id","divNameId_"+request["user_id"]);
     divName.style.paddingTop="10px";
     var link=document.createElement("a");
     // link.setAttribute("href","group_page.html");
         link.setAttribute("class","media-heading");
         //link.setAttribute("onClick","linktoprofilefunction(this);");
     link.setAttribute("id","linktoprofile_"+request["user_id"]);
         link.innerHTML="<h5>"+request["first_name"]+" "+request["last_name"]+"</h5>";
     
     divName.appendChild(link);
   requestCol.appendChild(divImg);
   requestCol.appendChild(divName);
   
   var buttonCol= document.createElement("div");
   buttonCol.setAttribute("class","col-xs-2");
    var  buttonToolbar=document.createElement("div");
         buttonToolbar.setAttribute("class", "btn-toolbar");
         buttonToolbar.setAttribute("role", "toolbar");
         buttonToolbar.setAttribute("id", "buttonToolbarId_"+request["user_id"]);
         buttonToolbar.setAttribute("aria-label","...");
         buttonToolbar.style.paddingTop="15px";
         
    var  buttonGroup =document.createElement("div");
         buttonGroup.setAttribute("class","btn-group");
         buttonGroup.setAttribute("role","group");
         buttonGroup.setAttribute("aria-label","...");
          var joinButton=document.createElement("BUTTON");
            joinButton.setAttribute("onClick","requestApprovefunction(this)");
            joinButton.setAttribute("id","button_approvejoingroup_"+request["user_id"]);
            joinButton.setAttribute("class","btn btn-success");
            joinButton.innerHTML="Approve";
			buttonGroup.appendChild(joinButton);
         var declineButton=document.createElement("BUTTON");
            declineButton.setAttribute("onClick","declineRequestfunction(this)");
            declineButton.setAttribute("id","button_declineRequest_"+request["user_id"]);
            declineButton.setAttribute("class","btn btn-danger");
            declineButton.innerHTML="Decline";
			buttonGroup.appendChild(declineButton);
	buttonToolbar.appendChild(buttonGroup);
	buttonCol.appendChild(buttonToolbar);
	requestMedia.appendChild(requestCol);
	requestMedia.appendChild(buttonCol);
                 
              
              document.getElementById("requestingmember").appendChild(requestMedia);
  }
  }
  }
  });
     
    
   // --------------------get posts ajax---------------------------------------------- 
     
       $.ajax({
type: "get",
contentType:"application/json",
url: "http://localhost:8080/facebook_group6/webapi/groups/"+sessionStorage.groupid+"/posts",
 
success: function (response) {
for(var j=0;j<response.length;j++){
var post=response[j];
 
console.log(post);
var postPanel=document.createElement("div");
   postPanel.setAttribute("class","panel panel-default");
   postPanel.setAttribute("id","postPanel_"+post["post_id"]);
   
   var postPanelBody=document.createElement("div");
       postPanelBody.setAttribute("class","panel-body");
       postPanelBody.setAttribute("id","postPanelBody_"+post["post_id"]);
        
     var postMedia=document.createElement("div");
         postMedia.setAttribute("class", "media");
         postMedia.setAttribute("id","postMedia_"+post["post_id"]);
 
 var divImg=document.createElement("div");
 divImg.setAttribute("class","media-left");
 divImg.setAttribute("id","divImageId_"+post["post_id"]);
     var image=document.createElement("IMG");
     image.setAttribute("class","media-object");
     image.setAttribute("src","users/"+post["user_id"]+"/"+post["profilePicUrl"]);
     image.style.width = "25px";
     divImg.appendChild(image);
 
     var divName=document.createElement("div");
         divName.setAttribute("class", "media-body");
                     divName.setAttribute("id","divNameId_"+post["post_id"]);
                     divName.style.paddingTop="1px";
                 var heading=document.createElement("H4");
                     heading.setAttribute("class","media-heading");
                     heading.innerHTML=post["fullName"];
                 var para=document.createElement("p");
                     para.innerHTML=post["post_date_time"];
                     divName.appendChild(heading);
                divName.appendChild(para);
              postMedia.appendChild(divImg);
              postMedia.appendChild(divName);
        postPanelBody.appendChild(postMedia);      
        postPanel.appendChild(postPanelBody);
        var postData=post["post_data"];
            if(postData["post_data_message"])
        {   
            var postDataText=document.createElement("p");
            postDataText.innerHTML=postData["post_data_message"];
            postPanelBody.appendChild(postDataText);
        }
                             
            if(postData["postImage"])
            {
            var postDataImage=document.createElement("IMG");
               postDataImage.style.height="200px";
               postDataImage.style.widht="200px";
               postDataImage.setAttribute("src","users/"+post["user_id"]+"/images/"+postData["postImage"]);
               postPanelBody.appendChild(postDataImage);
          }
 
    var postPanelFooter1=document.createElement("div");
        postPanelFooter1.setAttribute("class","panel-footer");
       // postPanelFooter1.style.display="inline";
        
              
         var postCommentLink=document.createElement("a");    
         postCommentLink.setAttribute("id","postCommentLink_"+post["post_id"]);
            postCommentLink.setAttribute("onClick","getCommentsLinkFunction(this)");
           //  postCommentLink.setAttribute("href","getCommentsLinkFunction(this)");
            // postCommentLink.setAttribute("data-toggle","collapse");
             //postCommentLink.setAttribute("href","#commentsOnPost_"+post["post_id"]);
             postCommentLink.style.paddingLeft="10px";
             var postShare=document.createElement("a");
             postShare.setAttribute("id","postShare_"+post["post_id"]);
             postShare.setAttribute("href","#");
            // postShare.setAttribute("onClick","postShareFunction(this)");
             postShare.innerHTML="Share";
             postShare.style.paddingLeft="10px";
            
             postPanelFooter1.appendChild(postCommentLink);
             postPanelFooter1.appendChild(postShare);
             postPanel.appendChild(postPanelFooter1);
        
        var postPanelFooter2=document.createElement("div");     
            postPanelFooter2.setAttribute("class","panel-footer collapse");
           // postPanelFooter2.setAttribute("id","postLikeCounts_"+post["post_id"]);
            postPanelFooter2.style.display="block";
            var postLikeCounts=document.createElement("div");
                postLikeCounts.setAttribute("id","postLikeCounts_"+post["post_id"]);
                postLikeCounts.style.display="none";
            postPanelFooter2.appendChild(postLikeCounts);
         var likes=post["listOfProfile"];
             if(likes.length==1 && (likes[0])["user_id"]==sessionStorage.id)
             {
             var postLike=document.createElement("a");
             postLike.setAttribute("onClick","postLikeFunction(this)");
    //         postLike.setAttribute("href","#");
             postLike.style.paddingLeft="10px";
             postLike.innerHTML="Unlike";
             postLike.setAttribute("id","postUnlike_"+post["post_id"]);
             postPanelFooter1.appendChild(postLike);
             
             var p=document.createElement("p");
             p.innerHTML="You Like this";
             postLikeCounts.appendChild(p);
             postLikeCounts.style.display="block";
             }
             else if(likes.length==1)
             { 
                                var postLike=document.createElement("a");
             postLike.setAttribute("onClick","postLikeFunction(this)");
      //       postLike.setAttribute("href","#");
             postLike.style.paddingLeft="10px";
             postLike.innerHTML="Like";
             postLike.setAttribute("id","postLike_"+post["post_id"]);
             postPanelFooter1.appendChild(postLike);
             
             var a=document.createElement("a");
             var p=document.createElement("p");
             p.innerHTML=" liked this";
             a.setAttribute("id","postLikesCountLink_"+post["post_id"]);
             a.innerHTML=(likes[0])["first_name"];
            p.prepend(a);
            postLikeCounts.appendChild(p);
            postLikeCounts.style.display="block";
             }
             else if(likes.length>1) {
                   var i=0;        
             for(i=0;i<likes.length;i++)
             {
               if((likes[i])["user_id"]==sessionStorage.id)
               {  
                var postLike=document.createElement("a");
             postLike.setAttribute("onClick","postLikeFunction(this)");
//              postLike.setAttribute("href","#");
             postLike.style.paddingLeft="10px";
             postLike.innerHTML="Unlike";
             postLike.setAttribute("id","postUnlike_"+post["post_id"]);
             postPanelFooter1.appendChild(postLike);
                                     var p=document.createElement("p");
                                     p.innerHTML="You and ";
                                     var a=document.createElement("a");
                                     if(likes.length-1==1)
                                     a.innerHTML=(likes.length-1)+" other ";
                                     else
                                     a.innerHTML=(likes.length-1)+" others ";
                                     a.setAttribute("id","postLikesCountLink_"+post["post_id"]);
                                     p.appendChild(a);
                                    // var p1=document.createElement("p");
                                    // p1.innerHTML="liked this";
                                     p.appendChild(document.createTextNode("liked this"));
                                     postLikeCounts.appendChild(p);
                postLikeCounts.style.display="block";
                                     break;
               }
               
             }
            if(i==likes.length)
                {
            var postLike=document.createElement("a");
             postLike.setAttribute("onClick","postLikeFunction(this)");
 //            postLike.setAttribute("href","#");
             postLike.style.paddingLeft="10px";
             postLike.innerHTML="Like";
             postLike.setAttribute("id","postLike_"+post["post_id"]);
             postPanelFooter1.appendChild(postLike);
             
            var p=document.createElement("p");
                                   p.innerHTML=(likes[0])["first_name"]+" and ";
                                   var a=document.createElement("a");
                                   if(likes.length-1==1)
                                   a.innerHTML=(likes.length-1)+" other ";
                                   else
                                   a.innerHTML=(likes.length-1)+" others ";
                                   a.setAttribute("id","postLikesCountLink_"+post["post_id"]);
                                   p.appendChild(a);
                                   var p1=document.createElement("p");
                                   
                                   p.appendChild(document.createTextNode("liked this"));
                                postLikeCounts.appendChild(p);
            postLikeCounts.style.display="block";
                                   
             
            }
             
             
             }
             else
             {
             var postLike=document.createElement("a");
             postLike.setAttribute("onClick","postLikeFunction(this)");
           //  postLike.setAttribute("href","#");
             postLike.style.paddingLeft="10px";
             postLike.innerHTML="Like";
             postLike.setAttribute("id","postLike_"+post["post_id"]);
             postPanelFooter1.appendChild(postLike);
             
             }
             
           
        var commentsOnPost=document.createElement("div");    
            commentsOnPost.setAttribute("id","commentsOnPost_"+post["post_id"]);
            postPanelFooter2.appendChild(commentsOnPost);
           
        
        var postComment=document.createElement("div");
            postComment.setAttribute("id","postComment_"+post["post_id"]);
             var postCommentInput=document.createElement("INPUT");
                 postCommentInput.setAttribute("type", "text");
                 postCommentInput.setAttribute("placeholder","Write Here!");
                 postCommentInput.setAttribute("id","postCommentInput_"+post["post_id"]);
                 postCommentInput.setAttribute("onkeydown","postCommentFunction(this)");
                 postCommentInput.setAttribute("value","");
                 postCommentInput.style.width="90%";
           postComment.appendChild(postCommentInput);
            postPanelFooter2.appendChild(postComment);     
            postPanel.appendChild(postPanelFooter2);
                          
            document.getElementById("postCol").appendChild(postPanel);
            
            
            //--------comments count------------
          var commentsCount=0;
            $.ajax({
type: "get",
async:false,
url: "http://localhost:8080/facebook_group6/webapi/comments/"+post["post_id"],
contentType: "application/json",
success: function (response) 
{
commentsCount=response.length;
}
            });
            
            if(commentsCount>0)
            postCommentLink.innerHTML="View "+commentsCount+" Comments";      
            
    //         alert(postCommentLink.innerHTML);
}
      
}
});
   }
       
       
   });

function postLikeFunction(x)
{
 
var id=(x.id).split("_");
 
if(id[0]=="postLike"){
$.ajax({
type: "post",
async:false,
url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/likes",
contentType: "application/json",
success: function (response) {
document.getElementById("postLike_"+id[1]).innerHTML="UnLike";
document.getElementById("postLike_"+id[1]).setAttribute("id","postUnlike_"+id[1]);
 
 
 
//-------------recalculate Like count after 'Like'-----------------------
 
$.ajax({
type: "get",
async:false,
url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/getLikes",
contentType: "application/json",
success: function (response1) {
var count1=response1.length;
if(count1==1)
{ document.getElementById("postLikeCounts_"+id[1]).style.display="block";
$("#postLikeCounts_"+id[1]).empty();
var p=document.createElement("p");
             p.innerHTML="You Like this";
             document.getElementById("postLikeCounts_"+id[1]).appendChild(p);
             
}
else
{
 
document.getElementById("postLikeCounts_"+id[1]).style.display="block";
$("#postLikeCounts_"+id[1]).empty();
var p=document.createElement("p");
                              p.innerHTML="You and ";
                              var a=document.createElement("a");
                              if(response1.length-1==1)
                              a.innerHTML=(response1.length-1)+" other ";
                              else
                             a.innerHTML=(response1.length-1)+" others ";
                              a.setAttribute("id","postLikesCountLink_"+id[1]);
                              p.appendChild(a);
                             // var p1=document.createElement("p");
                             // p1.innerHTML="liked this";
                              p.appendChild(document.createTextNode("liked this"));
                              document.getElementById("postLikeCounts_"+id[1]).appendChild(p);
             
}
 
}
});
 
//-------------recalculate likes count-----------------------
 
}
});
 
}
else
{ 
$.ajax({
type: "put",
async:false,
data:id[1],
url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/likes",
contentType: "application/json",
success: function (response) {
 
document.getElementById("postUnlike_"+id[1]).innerHTML="Like";
document.getElementById("postUnlike_"+id[1]).setAttribute("id","postLike_"+id[1]);
 
 
//-------------recalculate likes count-----------------------
 
$.ajax({
type: "get",
async:false,
url: "http://localhost:8080/facebook_group6/webapi/users/"+sessionStorage.id+"/posts/"+id[1]+"/getLikes",
contentType: "application/json",
success: function (response1) {
 
if(response1)
{
var count=response1.length;
 
if(count==0)
{document.getElementById("postLikeCounts_"+id[1]).style="none";
$("#postLikeCounts_"+id[1]).empty();
}
else if(count==1)
{
document.getElementById("postLikeCounts_"+id[1]).style.display="block";
$("#postLikeCounts_"+id[1]).empty();
var a=document.createElement("a");
             var p=document.createElement("p");
             p.innerHTML=" liked this";
             a.setAttribute("id","postLikesCountLink_"+id[1]);
             a.innerHTML=(response1[0])["first_name"];
            p.prepend(a);
            document.getElementById("postLikeCounts_"+id[1]).appendChild(p);
             
 
}
else
{
document.getElementById("postLikeCounts_"+id[1]).style.display="block";
$("#postLikeCounts_"+id[1]).empty();
var p=document.createElement("p");
                          p.innerHTML=(response1[0])["first_name"]+" and ";
                          var a=document.createElement("a");
                          if(response1.length-1==1)
                          a.innerHTML=(response1.length-1)+" other ";
                          else
                         a.innerHTML=(response1.length-1)+" others ";
                          a.setAttribute("id","postLikesCountLink_"+id[1]);
                          p.appendChild(a);
                          var p1=document.createElement("p");
                          
                          p.appendChild(document.createTextNode("liked this"));
                          document.getElementById("postLikeCounts_"+id[1]).appendChild(p);
                         
                        
 
}
 
}
 
 
}
});
//---------------recalculate likes count-----------------------
 
 
 
}
});
 
}
}
 
          
 
function getCommentsLinkFunction(x)
{   
 
var id=(x.id).split("_");
 
 
if($("#postCommentLink_"+id[1]).text().indexOf("View")!=-1){ 
// $("#commentsOnPost_"+id[1]).show();
document.getElementById("postCommentLink_"+id[1]).innerHTML="Hide Comments";
$.ajax({
type: "get",
url: "http://localhost:8080/facebook_group6/webapi/comments/"+id[1],
contentType: "application/json",
success: function (response) {
 
if(response)
{   
  $("#commentsOnPost_"+id[1]).empty();
     for(var i=0;i<response.length;i++)
     {
       var comment=response[i];
       
       var commentMedia=document.createElement("div");
commentMedia.setAttribute("class", "media");
commentMedia.setAttribute("id","commentMedia_"+comment["comment_id"]);
 
 
 
var divImg=document.createElement("div");
divImg.setAttribute("class","media-left");
divImg.setAttribute("id","divImageId_"+comment["comment_id"]);
divImg.style.paddingTop="1px";
    var image=document.createElement("IMG");
    image.setAttribute("class","media-object");
    image.setAttribute("src","users/"+comment["user_id"]+"/"+comment["profilePicUrl"]);
    image.style.width = "25px";
    divImg.appendChild(image);
 
var divName=document.createElement("div");
    divName.setAttribute("class", "media-body");
                divName.setAttribute("id","divNameId_"+comment["comment_id"]);
                divName.style.paddingTop="1px";
                var heading=document.createElement("H4");
                    heading.setAttribute("class","media-heading");
                    heading.innerHTML=comment["userName"];
                    
                var commentTime=document.createElement("p");
                    commentTime.innerHTML=comment["comment_Date_Time"];
                var commentPara=document.createElement("p");
                commentPara.innerHTML=comment["commentMessage"];
                divName.appendChild(heading);
                divName.appendChild(commentTime);
                divName.appendChild(commentPara);
              commentMedia.appendChild(divImg);
              commentMedia.appendChild(divName);
            document.getElementById("commentsOnPost_"+id[1]).appendChild(commentMedia); 
           
     
     }
 
}
}
});
}
else
{
var commentsCount=0;
$("#commentsOnPost_"+id[1]).empty();
 
 
$.ajax({
type: "get",
async:false,
url: "http://localhost:8080/facebook_group6/webapi/comments/"+id[1],
contentType: "application/json",
success: function (response) 
{  
commentsCount=response.length;
}
            });
if(commentsCount==0)
{ 
$("#postCommentLink_"+id[1]).hide();
}
else if(commentsCount==1)
{ 
 
$("#postCommentLink_"+id[1]).show();
document.getElementById("postCommentLink_"+id[1]).innerHTML="View "+commentsCount+" Comment";  
}
else
{
 
$("#postCommentLink_"+id[1]).show();
document.getElementById("postCommentLink_"+id[1]).innerHTML="View "+commentsCount+" Comments";
}
 
 
 
 
}
 
 
}
 
 
function postCommentFunction(x)
{
 
var id=(x.id).split("_");
if(x.value!="" && event.keyCode==13){
 
if($("#commentsOnPost_"+id[1]).css('display')=='none')
{
$("#commentsOnPost_"+id[1]).empty();
$("#commentsOnPost_"+id[1]).show();
 
}
var comment={"commentMessage":x.value}
 
$.ajax({
type: "post",
contentType:"application/json",
data:JSON.stringify(comment),
url: "http://localhost:8080/facebook_group6/webapi/comments/"+sessionStorage.id+"/"+id[1],
success: function (response) {
var commentMedia=document.createElement("div");
commentMedia.setAttribute("class", "media");
commentMedia.setAttribute("id","commentMedia_"+response["comment_id"]);
 
 
 
var divImg=document.createElement("div");
divImg.setAttribute("class","media-left");
divImg.setAttribute("id","divImageId_"+response["comment_id"]);
divImg.style.paddingTop="1px";
    var image=document.createElement("IMG");
    image.setAttribute("class","media-object");
    image.setAttribute("src","users/"+response["user_id"]+"/"+response["profilePicUrl"]);
    image.style.width = "25px";
    divImg.appendChild(image);
 
var divName=document.createElement("div");
    divName.setAttribute("class", "media-body");
                divName.setAttribute("id","divNameId_"+response["comment_id"]);
                divName.style.paddingTop="1px";
                var heading=document.createElement("H4");
                    heading.setAttribute("class","media-heading");
                    heading.innerHTML=response["userName"];
                    
                var commentTime=document.createElement("p");
                    commentTime.innerHTML=response["comment_Date_Time"];
                var commentPara=document.createElement("p");
                commentPara.innerHTML=response["commentMessage"];
                divName.appendChild(heading);
                divName.appendChild(commentTime);
                divName.appendChild(commentPara);
              commentMedia.appendChild(divImg);
              commentMedia.appendChild(divName);
            document.getElementById("commentsOnPost_"+id[1]).appendChild(commentMedia); 
            document.getElementById("postCommentInput_"+id[1]).value='';
 
}
});
 
}
}
 
function search()
{
console.log(document.getElementById("navBarSearch"));
if(event.keyCode==13 && document.getElementById("navBarSearch").value!=''){
$.ajax({
type: "get",
//url: "http://172.16.84.232:8080/fb/users/search?searchData="+document.getElementById("navBarSearch").value+"&from=home&userId="+sessionStorage.id,
url: "http://localhost:8080/facebook_group6/webapi/users/search?searchData="+document.getElementById("navBarSearch").value+"&from=home"+"&userId="+sessionStorage.id,
success: function (response) {
console.log(response+"profile");
window.location.href = "http://localhost:8080/facebook_group6/search.html";
}
});
}
}
 
</script>
 